var Z=Object.defineProperty;var z=(m,w,U)=>w in m?Z(m,w,{enumerable:!0,configurable:!0,writable:!0,value:U}):m[w]=U;var a=(m,w,U)=>(z(m,typeof w!="symbol"?w+"":w,U),U);(function(m,w){typeof exports=="object"&&typeof module!="undefined"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(m=typeof globalThis!="undefined"?globalThis:m||self,w(m.MMAPI={}))})(this,function(m){"use strict";class w{constructor(r){this.eventName=r}}class U extends w{constructor(r){super("packet");a(this,"payload");this.packet=r,this.payload=r[1]}}class W extends U{constructor(r){super(r);a(this,"type");this.type=r[0]}}class G extends U{constructor(r){super(r);a(this,"type");a(this,"isCanceled",!1);this.type=r[0]}}class D extends w{constructor(r){super("player");this.player=r}}class H extends w{constructor(r,s){super("health");this.sid=r,this.health=s}}class N extends w{constructor(r){super("build");this.building=r}}class q extends N{constructor(r){super(r)}}class M extends N{constructor(r,s){super(r);this.reason=s}}class K{constructor(r,s,u=!1){this.name=r,this.cb=s,this.once=u}}class V{constructor(){a(this,"events",[])}on(r,s){this.events.push(new K(r,s))}once(r,s){this.events.push(new K(r,s,!1))}emit(r,s){this.events.filter(u=>u.name!=r?!0:(u.cb(s),!u.once))}removeEvent(r){this.events.forEach(s=>{s.name==r&&(s.once=!0)})}}var O=(e=>(e.spawn="sp",e.chat="ch",e.attack="c",e.ping="pp",e.setAngle="2",e.selectItem="5",e.upgrade="6",e.autoAttack="7",e.createTribe="8",e.leaveTribe="9",e.requestJoinTribe="10",e.acceptTribeRequest="11",e.kickFromTribe="12",e.buyFromShop="13c",e.pingMap="14",e.move="33",e))(O||{}),v=(e=>(e.announce="ann",e.init="io-init",e.initTribe="id",e.setSid="1",e.kick="d",e.addPlayer="2",e.updatePlayers="33",e.removePlayer="4",e.updateLeaderBoard="5",e.addObject="6",e.updateAi="a",e.playerSwing="7",e.moostafaSwing="aa",e.wiggle="8",e.shootTurret="sp",e.updateMats="9",e.health="h",e.death="11",e.removeObject="12",e.removeAllObjects="13",e.setItemCount="14",e.setAge="15",e.listUpgrades="16",e.setItemsBar="17",e.addProjectile="18",e.removeProjectile="19",e.serverRestart="20",e.addTribe="ac",e.deleteTribe="ad",e.requestJoin="an",e.setTribe="st",e.setTribeMembers="sa",e.minimapLocation="mm",e.chat="ch",e.updateShop="us",e.ping="pp",e.dmgTest="t",e.pingMap="p",e))(v||{});class R{constructor(){a(this,"x",-2);a(this,"y",-2);a(this,"sid",-2);a(this,"id","NULL");a(this,"dir",0);a(this,"obj",-2);a(this,"wep",-2);a(this,"variant",-2);a(this,"tribe","NULL");a(this,"isLeader",!1);a(this,"hat",-2);a(this,"acc",-2);a(this,"isSkull",!1);a(this,"zIndex",-1);a(this,"health",100);a(this,"name","NULL")}assign(r){this.x=r.x,this.y=r.y,this.sid=r.sid,this.dir=r.dir,this.obj=r.obj,this.wep=r.wep,this.variant=r.variant,this.tribe=r.tribe,this.isLeader=r.isLeader,this.hat=r.hat,this.acc=r.acc,this.isSkull=r.isSkull,this.zIndex=r.zIndex}}function _(e){let s,u,l=new Uint8Array(128),f=0;return x(e),l.subarray(0,f);function x(n){switch(typeof n){case"undefined":g();break;case"boolean":y(n);break;case"number":I(n);break;case"string":E(n);break;case"object":n===null?g():n instanceof Date?t(n):Array.isArray(n)?p(n):n instanceof Uint8Array||n instanceof Uint8ClampedArray?h(n):n instanceof Int8Array||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array?p(n):b(n);break}}function g(n){d(192)}function y(n){d(n?195:194)}function I(n){if(isFinite(n)&&Math.floor(n)===n)if(n>=0&&n<=127)d(n);else if(n<0&&n>=-32)d(n);else if(n>0&&n<=255)o([204,n]);else if(n>=-128&&n<=127)o([208,n]);else if(n>0&&n<=65535)o([205,n>>>8,n]);else if(n>=-32768&&n<=32767)o([209,n>>>8,n]);else if(n>0&&n<=4294967295)o([206,n>>>24,n>>>16,n>>>8,n]);else if(n>=-2147483648&&n<=2147483647)o([210,n>>>24,n>>>16,n>>>8,n]);else if(n>0&&n<=18446744073709552e3){let i=n/4294967296,c=n%4294967296;o([211,i>>>24,i>>>16,i>>>8,i,c>>>24,c>>>16,c>>>8,c])}else n>=-9223372036854776e3&&n<=9223372036854776e3?(d(211),A(n)):n<0?o([211,128,0,0,0,0,0,0,0]):o([207,255,255,255,255,255,255,255,255]);else u||(s=new ArrayBuffer(8),u=new DataView(s)),u.setFloat64(0,n),d(203),o(new Uint8Array(s))}function E(n){let i=J(n),c=i.length;c<=31?d(160+c):c<=255?o([217,c]):c<=65535?o([218,c>>>8,c]):o([219,c>>>24,c>>>16,c>>>8,c]),o(i)}function p(n){let i=n.length;i<=15?d(144+i):i<=65535?o([220,i>>>8,i]):o([221,i>>>24,i>>>16,i>>>8,i]);for(let c=0;c<i;c++)x(n[c])}function h(n){let i=n.length;i<=15?o([196,i]):i<=65535?o([197,i>>>8,i]):o([198,i>>>24,i>>>16,i>>>8,i]),o(n)}function b(n){let i=0;for(let c in n)i++;i<=15?d(128+i):i<=65535?o([222,i>>>8,i]):o([223,i>>>24,i>>>16,i>>>8,i]);for(let c in n)x(c),x(n[c])}function t(n){let i=n.getTime()/1e3;if(n.getMilliseconds()===0&&i>=0&&i<4294967296)o([214,255,i>>>24,i>>>16,i>>>8,i]);else if(i>=0&&i<17179869184){let c=n.getMilliseconds()*1e6;o([215,255,c>>>22,c>>>14,c>>>6,c<<2>>>0|i/4294967296,i>>>24,i>>>16,i>>>8,i])}else{let c=n.getMilliseconds()*1e6;o([199,12,255,c>>>24,c>>>16,c>>>8,c]),A(i)}}function d(n){if(l.length<f+1){let i=l.length*2;for(;i<f+1;)i*=2;let c=new Uint8Array(i);c.set(l),l=c}l[f]=n,f++}function o(n){if(l.length<f+n.length){let i=l.length*2;for(;i<f+n.length;)i*=2;let c=new Uint8Array(i);c.set(l),l=c}l.set(n,f),f+=n.length}function A(n){let i,c;n>=0?(i=n/4294967296,c=n%4294967296):(n++,i=Math.abs(n)/4294967296,c=Math.abs(n)%4294967296,i=~i,c=~c),o([i>>>24,i>>>16,i>>>8,i,c>>>24,c>>>16,c>>>8,c])}}function Y(e){let s=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),typeof e!="object"||typeof e.length=="undefined")throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!e.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");e instanceof Uint8Array||(e=new Uint8Array(e));let u=l();return s<e.length,u;function l(){const t=e[s++];if(t>=0&&t<=127)return t;if(t>=128&&t<=143)return I(t-128);if(t>=144&&t<=159)return E(t-144);if(t>=160&&t<=191)return p(t-160);if(t===192)return null;if(t===193)throw new Error("Invalid byte code 0xc1 found.");if(t===194)return!1;if(t===195)return!0;if(t===196)return y(-1,1);if(t===197)return y(-1,2);if(t===198)return y(-1,4);if(t===199)return h(-1,1);if(t===200)return h(-1,2);if(t===201)return h(-1,4);if(t===202)return g(4);if(t===203)return g(8);if(t===204)return x(1);if(t===205)return x(2);if(t===206)return x(4);if(t===207)return x(8);if(t===208)return f(1);if(t===209)return f(2);if(t===210)return f(4);if(t===211)return f(8);if(t===212)return h(1);if(t===213)return h(2);if(t===214)return h(4);if(t===215)return h(8);if(t===216)return h(16);if(t===217)return p(-1,1);if(t===218)return p(-1,2);if(t===219)return p(-1,4);if(t===220)return E(-1,2);if(t===221)return E(-1,4);if(t===222)return I(-1,2);if(t===223)return I(-1,4);if(t>=224&&t<=255)return t-256;throw console.debug("msgpack array:",e),new Error("Invalid byte value '"+t+"' at index "+(s-1)+" in the MessagePack binary data (length "+e.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function f(t){let d=0,o=!0;for(;t-- >0;)if(o){let A=e[s++];d+=A&127,A&128&&(d-=128),o=!1}else d*=256,d+=e[s++];return d}function x(t){let d=0;for(;t-- >0;)d*=256,d+=e[s++];return d}function g(t){let d=new DataView(e.buffer,s,t);if(s+=t,t===4)return d.getFloat32(0,!1);if(t===8)return d.getFloat64(0,!1)}function y(t,d){t<0&&(t=x(d));let o=e.subarray(s,s+t);return s+=t,o}function I(t,d){t<0&&(t=x(d));let o={};for(;t-- >0;){let A=l();o[A]=l()}return o}function E(t,d){t<0&&(t=x(d));let o=[];for(;t-- >0;)o.push(l());return o}function p(t,d){t<0&&(t=x(d));let o=s;return s+=t,$(e,o,t)}function h(t,d){t<0&&(t=x(d));let o=x(1),A=y(t);switch(o){case 255:return b(A)}return{type:o,data:A}}function b(t){if(t.length===4){let d=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];return new Date(d*1e3)}if(t.length===8){let d=(t[0]<<22>>>0)+(t[1]<<14>>>0)+(t[2]<<6>>>0)+(t[3]>>>2),o=(t[3]&3)*4294967296+(t[4]<<24>>>0)+(t[5]<<16>>>0)+(t[6]<<8>>>0)+t[7];return new Date(o*1e3+d/1e6)}if(t.length===12){let d=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];s-=8;let o=f(8);return new Date(o*1e3+d/1e6)}throw new Error("Invalid data length for a date value.")}}function J(e){let r=!0,s=e.length;for(let f=0;f<s;f++)if(e.charCodeAt(f)>127){r=!1;break}let u=0,l=new Uint8Array(e.length*(r?1:4));for(let f=0;f!==s;f++){let x=e.charCodeAt(f);if(x<128){l[u++]=x;continue}if(x<2048)l[u++]=x>>6|192;else{if(x>55295&&x<56320){if(++f>=s)throw new Error("UTF-8 encode: incomplete surrogate pair");let g=e.charCodeAt(f);if(g<56320||g>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+g.toString(16)+" at index "+f+" out of range");x=65536+((x&1023)<<10)+(g&1023),l[u++]=x>>18|240,l[u++]=x>>12&63|128}else l[u++]=x>>12|224;l[u++]=x>>6&63|128}l[u++]=x&63|128}return r?l:l.subarray(0,u)}function $(e,r,s){let u=r,l="";for(s+=r;u<s;){let f=e[u++];if(f>127)if(f>191&&f<224){if(u>=s)throw new Error("UTF-8 decode: incomplete 2-byte sequence");f=(f&31)<<6|e[u++]&63}else if(f>223&&f<240){if(u+1>=s)throw new Error("UTF-8 decode: incomplete 3-byte sequence");f=(f&15)<<12|(e[u++]&63)<<6|e[u++]&63}else if(f>239&&f<248){if(u+2>=s)throw new Error("UTF-8 decode: incomplete 4-byte sequence");f=(f&7)<<18|(e[u++]&63)<<12|(e[u++]&63)<<6|e[u++]&63}else throw new Error("UTF-8 decode: unknown multibyte start 0x"+f.toString(16)+" at index "+(u-1));if(f<=65535)l+=String.fromCharCode(f);else if(f<=1114111)f-=65536,l+=String.fromCharCode(f>>10|55296),l+=String.fromCharCode(f&1023|56320);else throw new Error("UTF-8 decode: code point 0x"+f.toString(16)+" exceeds UTF-16 reach")}return l}var Q=Object.freeze(Object.defineProperty({__proto__:null,msgpack:{encode:_,decode:Y}},Symbol.toStringTag,{value:"Module"})),F=(e=>(e[e.BROWN=0]="BROWN",e[e.BEIGE=1]="BEIGE",e[e.DARKBROWN=2]="DARKBROWN",e[e.PEACH=3]="PEACH",e[e.WHITE=4]="WHITE",e[e.RED=5]="RED",e[e.BLACK=6]="BLACK",e[e.PINK=7]="PINK",e[e.BLUE=8]="BLUE",e[e.GREEN=9]="GREEN",e.SECRETLIGHTBLUE="length",e))(F||{}),L=(e=>(e[e.PLAYERLEAVE=0]="PLAYERLEAVE",e[e.BUILDINGBREAK=1]="BUILDINGBREAK",e))(L||{}),X=Q;const j=X.msgpack;class B extends V{constructor(){super();a(this,"socket",null);a(this,"player",new R);a(this,"players",[]);a(this,"gameObjects",[]);var r=this;class s extends WebSocket{hiddenSend(l){super.send(l)}constructor(l){super(l);this.send=f=>{const x=new G(j.decode(new Uint8Array(f)));r.emit("packetSend",x),!x.isCanceled&&this.hiddenSend(f)},r.socket=this,r.initSocket()}}Object.defineProperty(window,"WebSocket",{value:s})}initSocket(){var r;(r=this.socket)==null||r.addEventListener("message",s=>{const u=new W(j.decode(new Uint8Array(s.data)));this.emit("packetReceive",u);const l=u.payload;switch(u.type){case v.health:const x=l[0];this.emit("health",new H(x,l[1])),this.players[x].health=l[1];break;case v.init:this.player.id=l[0];break;case v.setSid:this.players[l[0]]=this.player,this.player.sid=l[0];break;case v.updatePlayers:for(let p=0;p<l[0].length;p+=13){const h=l[0].slice(p,p+13),b={sid:h[0],x:h[1],y:h[2],dir:h[3],obj:h[4],wep:h[5],variant:h[6],tribe:h[7],isLeader:h[8],hat:h[9],acc:h[10],isSkull:h[11],zIndex:h[12]};this.players[b.sid]||(console.warn("Ran into unpredicted circumstance current player cannot be found, IPlayerDat, this.players, IPlayerDat.sid",b,this.players,b.sid),this.players[b.sid]=new R),this.emit("updatePlayer",b),this.players[b.sid].assign(b)}break;case v.removePlayer:const g=this.getPlayerById(l[0]);g&&(this.emit("playerLeave",new D(g)),delete this.players[g.sid]);break;case v.addPlayer:const y=l[0],I=y[1],E=new R;E.sid=I,E.id=y[0],E.name=y[2],E.x=y[3],E.y=y[4],this.players[I]=E,this.emit("addPlayer",new D(E));break;case v.addObject:for(let p=0;p<l[0].length;p+=8){const h=l[0].slice(p,p+8),b={id:h[0],x:h[1],y:h[2],dir:h[3],scale:h[4],type:h[5],buildType:h[6],ownerSid:h[7]};this.gameObjects[b.id]=b,this.emit("addObject",new q(b))}break;case v.removeObject:this.emit("removeObject",new M(this.gameObjects[l[0]],L.BUILDINGBREAK)),delete this.gameObjects[l[0]];break;case v.removeAllObjects:for(let p=0;p<this.gameObjects.length;p++){const h=this.gameObjects[p];!h||h.ownerSid==l[0]&&(this.emit("removeObject",new M(this.gameObjects[p],L.PLAYERLEAVE)),this.gameObjects.slice(p,1))}break}})}getPlayerById(r){for(let s of this.players)if((s==null?void 0:s.id)==r)return s;return null}getPlayerBySid(r){for(let s of this.players)if((s==null?void 0:s.sid)==r)return s;return null}sendRaw(r){var s;(s=this.socket)==null||s.send(j.encode(r))}sendBasic(r,...s){this.sendRaw([r,s])}sendHidden(r,...s){var u=this.socket;u==null||u.hiddenSend(j.encode([r,s]))}spawn(r="moomooapi",s=F.RED,u=!0){this.sendBasic(O.spawn,{name:r,skin:s,moofoll:u})}}a(B,"SkinColours",F),a(B,"C2SPacketType",O),a(B,"S2CPacketType",v),a(B,"ObjectRemoveReason",L),Object.defineProperty(window,"MooMooAPI",{value:B}),m.MooMooAPI=B,m.msgpack2=j,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
