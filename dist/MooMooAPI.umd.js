var K=Object.defineProperty;var Q=(g,p,E)=>p in g?K(g,p,{enumerable:!0,configurable:!0,writable:!0,value:E}):g[p]=E;var d=(g,p,E)=>(Q(g,typeof p!="symbol"?p+"":p,E),E);(function(g,p){typeof exports=="object"&&typeof module!="undefined"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(g=typeof globalThis!="undefined"?globalThis:g||self,p(g.MMAPI={}))})(this,function(g){"use strict";class p{constructor(i){this.eventName=i}}class E extends p{constructor(i){super("packet");d(this,"payload");this.packet=i,this.payload=i[1]}}class O extends E{constructor(i){super(i);d(this,"type");this.type=i[0]}}class q extends E{constructor(i){super(i);d(this,"type");d(this,"isCanceled",!1);this.type=i[0]}}class D extends p{constructor(i){super("player");this.player=i}}class N extends p{constructor(i,f){super("health");this.sid=i,this.health=f}}class R{constructor(i,f,u=!1){this.name=i,this.cb=f,this.once=u}}class _{constructor(){d(this,"events",[])}on(i,f){this.events.push(new R(i,f))}once(i,f){this.events.push(new R(i,f,!1))}emit(i,f){this.events.filter(u=>u.name!=i?!0:(u.cb(f),!u.once))}removeEvent(i){this.events.forEach(f=>{f.name==i&&(f.once=!0)})}}var L=(e=>(e.spawn="sp",e.chat="ch",e.attack="c",e.ping="pp",e.setAngle="2",e.selectItem="5",e.upgrade="6",e.autoAttack="7",e.createTribe="8",e.leaveTribe="9",e.requestJoinTribe="10",e.acceptTribeRequest="11",e.kickFromTribe="12",e.buyFromShop="13c",e.pingMap="14",e.move="33",e))(L||{}),U=(e=>(e.announce="ann",e.init="io-init",e.initTribe="id",e.setSid="1",e.kick="d",e.addPlayer="2",e.updatePlayers="33",e.removePlayer="4",e.updateLeaderBoard="5",e.addObject="6",e.updateAi="a",e.playerSwing="7",e.moostafaSwing="aa",e.wiggle="8",e.shootTurret="sp",e.updateMats="9",e.health="h",e.death="11",e.removeBuild="12",e.removeObject="13",e.setItemCount="14",e.setAge="15",e.listUpgrades="16",e.setItemsBar="17",e.addProjectile="18",e.removeProjectile="19",e.serverRestart="20",e.addTribe="ac",e.deleteTribe="ad",e.requestJoin="an",e.setTribe="st",e.setTribeMembers="sa",e.minimapLocation="mm",e.chat="ch",e.updateShop="us",e.ping="pp",e.dmgTest="t",e.pingMap="p",e))(U||{});class j{constructor(){d(this,"x",-2);d(this,"y",-2);d(this,"sid",-2);d(this,"id","NULL");d(this,"dir",0);d(this,"obj",-2);d(this,"wep",-2);d(this,"variant",-2);d(this,"tribe","NULL");d(this,"isLeader",!1);d(this,"hat",-2);d(this,"acc",-2);d(this,"isSkull",!1);d(this,"zIndex",-1);d(this,"health",100);d(this,"name","NULL")}assign(i){this.x=i.x,this.y=i.y,this.sid=i.sid,this.dir=i.dir,this.obj=i.obj,this.wep=i.wep,this.variant=i.variant,this.tribe=i.tribe,this.isLeader=i.isLeader,this.hat=i.hat,this.acc=i.acc,this.isSkull=i.isSkull,this.zIndex=i.zIndex}}function V(e){let f,u,o=new Uint8Array(128),s=0;return x(e),o.subarray(0,s);function x(t){switch(typeof t){case"undefined":w();break;case"boolean":m(t);break;case"number":I(t);break;case"string":b(t);break;case"object":t===null?w():t instanceof Date?n(t):Array.isArray(t)?v(t):t instanceof Uint8Array||t instanceof Uint8ClampedArray?a(t):t instanceof Int8Array||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?v(t):y(t);break}}function w(t){h(192)}function m(t){h(t?195:194)}function I(t){if(isFinite(t)&&Math.floor(t)===t)if(t>=0&&t<=127)h(t);else if(t<0&&t>=-32)h(t);else if(t>0&&t<=255)c([204,t]);else if(t>=-128&&t<=127)c([208,t]);else if(t>0&&t<=65535)c([205,t>>>8,t]);else if(t>=-32768&&t<=32767)c([209,t>>>8,t]);else if(t>0&&t<=4294967295)c([206,t>>>24,t>>>16,t>>>8,t]);else if(t>=-2147483648&&t<=2147483647)c([210,t>>>24,t>>>16,t>>>8,t]);else if(t>0&&t<=18446744073709552e3){let r=t/4294967296,l=t%4294967296;c([211,r>>>24,r>>>16,r>>>8,r,l>>>24,l>>>16,l>>>8,l])}else t>=-9223372036854776e3&&t<=9223372036854776e3?(h(211),A(t)):t<0?c([211,128,0,0,0,0,0,0,0]):c([207,255,255,255,255,255,255,255,255]);else u||(f=new ArrayBuffer(8),u=new DataView(f)),u.setFloat64(0,t),h(203),c(new Uint8Array(f))}function b(t){let r=H(t),l=r.length;l<=31?h(160+l):l<=255?c([217,l]):l<=65535?c([218,l>>>8,l]):c([219,l>>>24,l>>>16,l>>>8,l]),c(r)}function v(t){let r=t.length;r<=15?h(144+r):r<=65535?c([220,r>>>8,r]):c([221,r>>>24,r>>>16,r>>>8,r]);for(let l=0;l<r;l++)x(t[l])}function a(t){let r=t.length;r<=15?c([196,r]):r<=65535?c([197,r>>>8,r]):c([198,r>>>24,r>>>16,r>>>8,r]),c(t)}function y(t){let r=0;for(let l in t)r++;r<=15?h(128+r):r<=65535?c([222,r>>>8,r]):c([223,r>>>24,r>>>16,r>>>8,r]);for(let l in t)x(l),x(t[l])}function n(t){let r=t.getTime()/1e3;if(t.getMilliseconds()===0&&r>=0&&r<4294967296)c([214,255,r>>>24,r>>>16,r>>>8,r]);else if(r>=0&&r<17179869184){let l=t.getMilliseconds()*1e6;c([215,255,l>>>22,l>>>14,l>>>6,l<<2>>>0|r/4294967296,r>>>24,r>>>16,r>>>8,r])}else{let l=t.getMilliseconds()*1e6;c([199,12,255,l>>>24,l>>>16,l>>>8,l]),A(r)}}function h(t){if(o.length<s+1){let r=o.length*2;for(;r<s+1;)r*=2;let l=new Uint8Array(r);l.set(o),o=l}o[s]=t,s++}function c(t){if(o.length<s+t.length){let r=o.length*2;for(;r<s+t.length;)r*=2;let l=new Uint8Array(r);l.set(o),o=l}o.set(t,s),s+=t.length}function A(t){let r,l;t>=0?(r=t/4294967296,l=t%4294967296):(t++,r=Math.abs(t)/4294967296,l=Math.abs(t)%4294967296,r=~r,l=~l),c([r>>>24,r>>>16,r>>>8,r,l>>>24,l>>>16,l>>>8,l])}}function W(e){let f=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),typeof e!="object"||typeof e.length=="undefined")throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!e.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");e instanceof Uint8Array||(e=new Uint8Array(e));let u=o();return f<e.length,u;function o(){const n=e[f++];if(n>=0&&n<=127)return n;if(n>=128&&n<=143)return I(n-128);if(n>=144&&n<=159)return b(n-144);if(n>=160&&n<=191)return v(n-160);if(n===192)return null;if(n===193)throw new Error("Invalid byte code 0xc1 found.");if(n===194)return!1;if(n===195)return!0;if(n===196)return m(-1,1);if(n===197)return m(-1,2);if(n===198)return m(-1,4);if(n===199)return a(-1,1);if(n===200)return a(-1,2);if(n===201)return a(-1,4);if(n===202)return w(4);if(n===203)return w(8);if(n===204)return x(1);if(n===205)return x(2);if(n===206)return x(4);if(n===207)return x(8);if(n===208)return s(1);if(n===209)return s(2);if(n===210)return s(4);if(n===211)return s(8);if(n===212)return a(1);if(n===213)return a(2);if(n===214)return a(4);if(n===215)return a(8);if(n===216)return a(16);if(n===217)return v(-1,1);if(n===218)return v(-1,2);if(n===219)return v(-1,4);if(n===220)return b(-1,2);if(n===221)return b(-1,4);if(n===222)return I(-1,2);if(n===223)return I(-1,4);if(n>=224&&n<=255)return n-256;throw console.debug("msgpack array:",e),new Error("Invalid byte value '"+n+"' at index "+(f-1)+" in the MessagePack binary data (length "+e.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function s(n){let h=0,c=!0;for(;n-- >0;)if(c){let A=e[f++];h+=A&127,A&128&&(h-=128),c=!1}else h*=256,h+=e[f++];return h}function x(n){let h=0;for(;n-- >0;)h*=256,h+=e[f++];return h}function w(n){let h=new DataView(e.buffer,f,n);if(f+=n,n===4)return h.getFloat32(0,!1);if(n===8)return h.getFloat64(0,!1)}function m(n,h){n<0&&(n=x(h));let c=e.subarray(f,f+n);return f+=n,c}function I(n,h){n<0&&(n=x(h));let c={};for(;n-- >0;){let A=o();c[A]=o()}return c}function b(n,h){n<0&&(n=x(h));let c=[];for(;n-- >0;)c.push(o());return c}function v(n,h){n<0&&(n=x(h));let c=f;return f+=n,J(e,c,n)}function a(n,h){n<0&&(n=x(h));let c=x(1),A=m(n);switch(c){case 255:return y(A)}return{type:c,data:A}}function y(n){if(n.length===4){let h=(n[0]<<24>>>0)+(n[1]<<16>>>0)+(n[2]<<8>>>0)+n[3];return new Date(h*1e3)}if(n.length===8){let h=(n[0]<<22>>>0)+(n[1]<<14>>>0)+(n[2]<<6>>>0)+(n[3]>>>2),c=(n[3]&3)*4294967296+(n[4]<<24>>>0)+(n[5]<<16>>>0)+(n[6]<<8>>>0)+n[7];return new Date(c*1e3+h/1e6)}if(n.length===12){let h=(n[0]<<24>>>0)+(n[1]<<16>>>0)+(n[2]<<8>>>0)+n[3];f-=8;let c=s(8);return new Date(c*1e3+h/1e6)}throw new Error("Invalid data length for a date value.")}}function H(e){let i=!0,f=e.length;for(let s=0;s<f;s++)if(e.charCodeAt(s)>127){i=!1;break}let u=0,o=new Uint8Array(e.length*(i?1:4));for(let s=0;s!==f;s++){let x=e.charCodeAt(s);if(x<128){o[u++]=x;continue}if(x<2048)o[u++]=x>>6|192;else{if(x>55295&&x<56320){if(++s>=f)throw new Error("UTF-8 encode: incomplete surrogate pair");let w=e.charCodeAt(s);if(w<56320||w>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+w.toString(16)+" at index "+s+" out of range");x=65536+((x&1023)<<10)+(w&1023),o[u++]=x>>18|240,o[u++]=x>>12&63|128}else o[u++]=x>>12|224;o[u++]=x>>6&63|128}o[u++]=x&63|128}return i?o:o.subarray(0,u)}function J(e,i,f){let u=i,o="";for(f+=i;u<f;){let s=e[u++];if(s>127)if(s>191&&s<224){if(u>=f)throw new Error("UTF-8 decode: incomplete 2-byte sequence");s=(s&31)<<6|e[u++]&63}else if(s>223&&s<240){if(u+1>=f)throw new Error("UTF-8 decode: incomplete 3-byte sequence");s=(s&15)<<12|(e[u++]&63)<<6|e[u++]&63}else if(s>239&&s<248){if(u+2>=f)throw new Error("UTF-8 decode: incomplete 4-byte sequence");s=(s&7)<<18|(e[u++]&63)<<12|(e[u++]&63)<<6|e[u++]&63}else throw new Error("UTF-8 decode: unknown multibyte start 0x"+s.toString(16)+" at index "+(u-1));if(s<=65535)o+=String.fromCharCode(s);else if(s<=1114111)s-=65536,o+=String.fromCharCode(s>>10|55296),o+=String.fromCharCode(s&1023|56320);else throw new Error("UTF-8 decode: code point 0x"+s.toString(16)+" exceeds UTF-16 reach")}return o}var $=Object.freeze(Object.defineProperty({__proto__:null,msgpack:{encode:V,decode:W}},Symbol.toStringTag,{value:"Module"})),M=(e=>(e[e.brown=0]="brown",e[e.beige=1]="beige",e[e.darkBrown=2]="darkBrown",e[e.peach=3]="peach",e[e.white=4]="white",e[e.red=5]="red",e[e.black=6]="black",e[e.pink=7]="pink",e[e.blue=8]="blue",e[e.green=9]="green",e.secretLightBlue="length",e))(M||{}),G=$;const F=G.msgpack;class B extends _{constructor(){super();d(this,"socket",null);d(this,"player",new j);d(this,"players",[]);var i=this;class f extends WebSocket{hiddenSend(o){super.send(o)}constructor(o){super(o);this.send=s=>{const x=new q(F.decode(new Uint8Array(s)));i.onPacketSend(x)||(i.emit("packetSend",x),this.hiddenSend(s))},i.socket=this,i.initSocket()}}Object.defineProperty(window,"WebSocket",{value:f})}initSocket(){var i;(i=this.socket)==null||i.addEventListener("message",f=>{const u=new O(F.decode(new Uint8Array(f.data)));this.emit("packetReceive",u),this.onPacketReceive(u);const o=u.payload;switch(u.type){case U.health:const x=o[0];this.emit("health",new N(x,o[1])),this.players[x].health=o[1];break;case U.init:this.player.id=o[0];break;case U.setSid:this.players[o[0]]=this.player,this.player.sid=o[0];break;case U.updatePlayers:for(let v=0;v<o[0].length;v+=13){const a=o[0].slice(v,v+13),y={sid:a[0],x:a[1],y:a[2],dir:a[3],obj:a[4],wep:a[5],variant:a[6],tribe:a[7],isLeader:a[8],hat:a[9],acc:a[10],isSkull:a[11],zIndex:a[12]};this.players[y.sid]||(console.warn("Ran into unpredicted circumstance current player cannot be found, IPlayerDat, this.players, IPlayerDat.sid",y,this.players,y.sid),this.players[y.sid]=new j),this.emit("updatePlayer",y),this.players[y.sid].assign(y)}break;case U.removePlayer:const w=this.getPlayerById(o[0]);console.log(w,o,this.players,o[0]),w&&(this.emit("playerLeave",new D(w)),delete this.players[w.sid]);break;case U.addPlayer:const m=o[0],I=m[1],b=new j;b.sid=I,b.id=m[0],b.name=m[2],b.x=m[3],b.y=m[4],this.players[I]=b,this.emit("addPlayer",new D(b));break}})}getPlayerById(i){for(let f of this.players)if((f==null?void 0:f.id)==i)return f;return null}onPacketSend(i){return!1}onPacketReceive(i){}sendRaw(i){var f;(f=this.socket)==null||f.send(F.encode(i))}sendBasic(i,...f){this.sendRaw([i,f])}sendHidden(i,...f){var u=this.socket;u==null||u.hiddenSend(F.encode([i,f]))}spawn(i="moomooapi",f=M.red,u=!0){this.sendBasic(L.spawn,{name:i,skin:f,moofoll:u})}}d(B,"SkinColours",M),d(B,"C2SPacketType",L),d(B,"S2CPacketType",U),Object.defineProperty(window,"MooMooAPI",{value:B}),g.MooMooAPI=B,g.msgpack2=F,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
