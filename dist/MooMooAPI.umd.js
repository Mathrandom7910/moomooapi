var z=Object.defineProperty;var k=(w,g,_)=>g in w?z(w,g,{enumerable:!0,configurable:!0,writable:!0,value:_}):w[g]=_;var E=(w,g,_)=>(k(w,typeof g!="symbol"?g+"":g,_),_);(function(w,g){typeof exports=="object"&&typeof module!="undefined"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(w=typeof globalThis!="undefined"?globalThis:w||self,g(w.MMAPI={}))})(this,function(w){"use strict";class g{constructor(r){this.eventName=r}}class _ extends g{constructor(r){super("packet");E(this,"payload");this.packet=r,this.payload=r[1]}}class K extends _{constructor(r){super(r);E(this,"type");this.type=r[0]}}class H extends _{constructor(r){super(r);E(this,"type");E(this,"isCanceled",!1);this.type=r[0]}}class F extends g{constructor(r){super("player");this.player=r}}class S extends g{constructor(r,n){super("health");this.sid=r,this.health=n}}class j extends g{constructor(r){super("build");this.building=r}}class W extends j{constructor(r){super(r)}}class P extends j{constructor(r,n){super(r);this.reason=n}}class G{constructor(r,n,h=!1){this.name=r,this.cb=n,this.once=h}}class q{constructor(){E(this,"events",[])}on(r,n){this.events.push(new G(r,n))}once(r,n){this.events.push(new G(r,n,!0))}emit(r,n){this.events.filter(h=>h.name!=r?!0:(h.cb(n),!h.once))}removeEvent(r){this.events.forEach(n=>{n.name==r&&(n.once=!0)})}}var N=(e=>(e.spawn="sp",e.chat="ch",e.attack="c",e.ping="pp",e.setAngle="2",e.selectItem="5",e.upgrade="6",e.autoAttack="7",e.createTribe="8",e.leaveTribe="9",e.requestJoinTribe="10",e.acceptTribeRequest="11",e.kickFromTribe="12",e.buyFromShop="13c",e.pingMap="14",e.move="33",e))(N||{}),b=(e=>(e.announce="ann",e.init="io-init",e.initTribe="id",e.setSid="1",e.kick="d",e.addPlayer="2",e.updatePlayers="33",e.removePlayer="4",e.updateLeaderBoard="5",e.addObject="6",e.updateAi="a",e.playerSwing="7",e.moostafaSwing="aa",e.wiggle="8",e.shootTurret="sp",e.updateMats="9",e.health="h",e.death="11",e.removeObject="12",e.removeAllObjects="13",e.setItemCount="14",e.setAge="15",e.listUpgrades="16",e.setItemsBar="17",e.addProjectile="18",e.removeProjectile="19",e.serverRestart="20",e.addTribe="ac",e.deleteTribe="ad",e.requestJoin="an",e.setTribe="st",e.setTribeMembers="sa",e.minimapLocation="mm",e.chat="ch",e.updateShop="us",e.ping="pp",e.dmgTest="t",e.pingMap="p",e))(b||{}),A=(e=>(e[e.APPLE=0]="APPLE",e[e.COOKIE=1]="COOKIE",e[e.CHEESE=2]="CHEESE",e[e.WOOD_WALL=3]="WOOD_WALL",e[e.STONE_WALL=4]="STONE_WALL",e[e.CASTLE_WALL=5]="CASTLE_WALL",e[e.SPIKE=6]="SPIKE",e[e.GREATER_SPIKE=7]="GREATER_SPIKE",e[e.POISON_SPIKE=8]="POISON_SPIKE",e[e.SPINNING_SPIKE=9]="SPINNING_SPIKE",e[e.WINDMILL=10]="WINDMILL",e[e.FASTER_WINDMILL=11]="FASTER_WINDMILL",e[e.POWER_MILL=12]="POWER_MILL",e[e.MINE=13]="MINE",e[e.SAPPLING=14]="SAPPLING",e[e.PIT_TRAP=15]="PIT_TRAP",e[e.BOOST_PAD=16]="BOOST_PAD",e[e.TURRET=17]="TURRET",e[e.PLATFORM=18]="PLATFORM",e[e.HEALING_PAD=19]="HEALING_PAD",e[e.SPAWN_PAD=20]="SPAWN_PAD",e[e.BLOCKER=21]="BLOCKER",e[e.TELEPORTER=22]="TELEPORTER",e))(A||{}),D=(e=>(e[e.TOOL_HAMMER=0]="TOOL_HAMMER",e[e.HAND_AXE=1]="HAND_AXE",e[e.GREAT_AXE=2]="GREAT_AXE",e[e.SHORT_SWORD=3]="SHORT_SWORD",e[e.KATANA=4]="KATANA",e[e.POLE_ARM=5]="POLE_ARM",e[e.BAT=6]="BAT",e[e.DAGGERS=7]="DAGGERS",e[e.STICK=8]="STICK",e[e.HUNTING_BOW=9]="HUNTING_BOW",e[e.GREAT_HAMMER=10]="GREAT_HAMMER",e[e.WOODEN_SHIELD=11]="WOODEN_SHIELD",e[e.CROSSBOW=12]="CROSSBOW",e[e.REPEATER_CROSSBOW=13]="REPEATER_CROSSBOW",e[e.MC_GRABBY=14]="MC_GRABBY",e[e.MUSKET=15]="MUSKET",e))(D||{});class T{constructor(){E(this,"x",-2);E(this,"y",-2);E(this,"sid",-2);E(this,"id","NULL");E(this,"dir",0);E(this,"obj",-2);E(this,"wep",-2);E(this,"variant",-2);E(this,"tribe","NULL");E(this,"isLeader",!1);E(this,"hat",-2);E(this,"acc",-2);E(this,"isSkull",!1);E(this,"zIndex",-1);E(this,"health",100);E(this,"name","NULL")}assign(r){console.log(r),this.x=r.x,this.y=r.y,this.sid=r.sid,this.dir=r.dir,this.obj=r.obj,this.wep=r.wep,this.variant=r.variant,this.tribe=r.tribe,this.isLeader=r.isLeader,this.hat=r.hat,this.acc=r.acc,this.isSkull=r.isSkull,this.zIndex=r.zIndex}}class V extends T{constructor(){super(...arguments);E(this,"weapons",[D.TOOL_HAMMER,void 0]);E(this,"items",[A.APPLE,A.WOOD_WALL,A.SPIKE,A.WINDMILL,void 0,void 0,void 0,void 0])}getFoodType(){return this.items[0]}getWallType(){return this.items[1]}getSpikeType(){return this.items[2]}getMillType(){return this.items[3]}searchForId(r){for(let n of this.items)if(n==r)return n;return null}getSapplingType(){return this.searchForId(A.SAPPLING)}getMineType(){return this.searchForId(A.MINE)}getSpecialType(){return this.searchForId(A.TURRET)||this.searchForId(A.BLOCKER)||this.searchForId(A.HEALING_PAD)||this.searchForId(A.PLATFORM)||this.searchForId(A.TELEPORTER)}getPadType(){return this.items[4]||null}getPrimaryType(){return this.items[0]}getSecondaryType(){return this.items[1]}}function Y(e){let n,h,f=new Uint8Array(128),l=0;return u(e),f.subarray(0,l);function u(i){switch(typeof i){case"undefined":L();break;case"boolean":R(i);break;case"number":O(i);break;case"string":y(i);break;case"object":i===null?L():i instanceof Date?t(i):Array.isArray(i)?d(i):i instanceof Uint8Array||i instanceof Uint8ClampedArray?a(i):i instanceof Int8Array||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array?d(i):p(i);break}}function L(i){x(192)}function R(i){x(i?195:194)}function O(i){if(isFinite(i)&&Math.floor(i)===i)if(i>=0&&i<=127)x(i);else if(i<0&&i>=-32)x(i);else if(i>0&&i<=255)o([204,i]);else if(i>=-128&&i<=127)o([208,i]);else if(i>0&&i<=65535)o([205,i>>>8,i]);else if(i>=-32768&&i<=32767)o([209,i>>>8,i]);else if(i>0&&i<=4294967295)o([206,i>>>24,i>>>16,i>>>8,i]);else if(i>=-2147483648&&i<=2147483647)o([210,i>>>24,i>>>16,i>>>8,i]);else if(i>0&&i<=18446744073709552e3){let s=i/4294967296,c=i%4294967296;o([211,s>>>24,s>>>16,s>>>8,s,c>>>24,c>>>16,c>>>8,c])}else i>=-9223372036854776e3&&i<=9223372036854776e3?(x(211),v(i)):i<0?o([211,128,0,0,0,0,0,0,0]):o([207,255,255,255,255,255,255,255,255]);else h||(n=new ArrayBuffer(8),h=new DataView(n)),h.setFloat64(0,i),x(203),o(new Uint8Array(n))}function y(i){let s=J(i),c=s.length;c<=31?x(160+c):c<=255?o([217,c]):c<=65535?o([218,c>>>8,c]):o([219,c>>>24,c>>>16,c>>>8,c]),o(s)}function d(i){let s=i.length;s<=15?x(144+s):s<=65535?o([220,s>>>8,s]):o([221,s>>>24,s>>>16,s>>>8,s]);for(let c=0;c<s;c++)u(i[c])}function a(i){let s=i.length;s<=15?o([196,s]):s<=65535?o([197,s>>>8,s]):o([198,s>>>24,s>>>16,s>>>8,s]),o(i)}function p(i){let s=0;for(let c in i)s++;s<=15?x(128+s):s<=65535?o([222,s>>>8,s]):o([223,s>>>24,s>>>16,s>>>8,s]);for(let c in i)u(c),u(i[c])}function t(i){let s=i.getTime()/1e3;if(i.getMilliseconds()===0&&s>=0&&s<4294967296)o([214,255,s>>>24,s>>>16,s>>>8,s]);else if(s>=0&&s<17179869184){let c=i.getMilliseconds()*1e6;o([215,255,c>>>22,c>>>14,c>>>6,c<<2>>>0|s/4294967296,s>>>24,s>>>16,s>>>8,s])}else{let c=i.getMilliseconds()*1e6;o([199,12,255,c>>>24,c>>>16,c>>>8,c]),v(s)}}function x(i){if(f.length<l+1){let s=f.length*2;for(;s<l+1;)s*=2;let c=new Uint8Array(s);c.set(f),f=c}f[l]=i,l++}function o(i){if(f.length<l+i.length){let s=f.length*2;for(;s<l+i.length;)s*=2;let c=new Uint8Array(s);c.set(f),f=c}f.set(i,l),l+=i.length}function v(i){let s,c;i>=0?(s=i/4294967296,c=i%4294967296):(i++,s=Math.abs(i)/4294967296,c=Math.abs(i)%4294967296,s=~s,c=~c),o([s>>>24,s>>>16,s>>>8,s,c>>>24,c>>>16,c>>>8,c])}}function X(e){let n=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),typeof e!="object"||typeof e.length=="undefined")throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!e.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");e instanceof Uint8Array||(e=new Uint8Array(e));let h=f();return n<e.length,h;function f(){const t=e[n++];if(t>=0&&t<=127)return t;if(t>=128&&t<=143)return O(t-128);if(t>=144&&t<=159)return y(t-144);if(t>=160&&t<=191)return d(t-160);if(t===192)return null;if(t===193)throw new Error("Invalid byte code 0xc1 found.");if(t===194)return!1;if(t===195)return!0;if(t===196)return R(-1,1);if(t===197)return R(-1,2);if(t===198)return R(-1,4);if(t===199)return a(-1,1);if(t===200)return a(-1,2);if(t===201)return a(-1,4);if(t===202)return L(4);if(t===203)return L(8);if(t===204)return u(1);if(t===205)return u(2);if(t===206)return u(4);if(t===207)return u(8);if(t===208)return l(1);if(t===209)return l(2);if(t===210)return l(4);if(t===211)return l(8);if(t===212)return a(1);if(t===213)return a(2);if(t===214)return a(4);if(t===215)return a(8);if(t===216)return a(16);if(t===217)return d(-1,1);if(t===218)return d(-1,2);if(t===219)return d(-1,4);if(t===220)return y(-1,2);if(t===221)return y(-1,4);if(t===222)return O(-1,2);if(t===223)return O(-1,4);if(t>=224&&t<=255)return t-256;throw console.debug("msgpack array:",e),new Error("Invalid byte value '"+t+"' at index "+(n-1)+" in the MessagePack binary data (length "+e.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function l(t){let x=0,o=!0;for(;t-- >0;)if(o){let v=e[n++];x+=v&127,v&128&&(x-=128),o=!1}else x*=256,x+=e[n++];return x}function u(t){let x=0;for(;t-- >0;)x*=256,x+=e[n++];return x}function L(t){let x=new DataView(e.buffer,n,t);if(n+=t,t===4)return x.getFloat32(0,!1);if(t===8)return x.getFloat64(0,!1)}function R(t,x){t<0&&(t=u(x));let o=e.subarray(n,n+t);return n+=t,o}function O(t,x){t<0&&(t=u(x));let o={};for(;t-- >0;){let v=f();o[v]=f()}return o}function y(t,x){t<0&&(t=u(x));let o=[];for(;t-- >0;)o.push(f());return o}function d(t,x){t<0&&(t=u(x));let o=n;return n+=t,$(e,o,t)}function a(t,x){t<0&&(t=u(x));let o=u(1),v=R(t);switch(o){case 255:return p(v)}return{type:o,data:v}}function p(t){if(t.length===4){let x=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];return new Date(x*1e3)}if(t.length===8){let x=(t[0]<<22>>>0)+(t[1]<<14>>>0)+(t[2]<<6>>>0)+(t[3]>>>2),o=(t[3]&3)*4294967296+(t[4]<<24>>>0)+(t[5]<<16>>>0)+(t[6]<<8>>>0)+t[7];return new Date(o*1e3+x/1e6)}if(t.length===12){let x=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];n-=8;let o=l(8);return new Date(o*1e3+x/1e6)}throw new Error("Invalid data length for a date value.")}}function J(e){let r=!0,n=e.length;for(let l=0;l<n;l++)if(e.charCodeAt(l)>127){r=!1;break}let h=0,f=new Uint8Array(e.length*(r?1:4));for(let l=0;l!==n;l++){let u=e.charCodeAt(l);if(u<128){f[h++]=u;continue}if(u<2048)f[h++]=u>>6|192;else{if(u>55295&&u<56320){if(++l>=n)throw new Error("UTF-8 encode: incomplete surrogate pair");let L=e.charCodeAt(l);if(L<56320||L>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+L.toString(16)+" at index "+l+" out of range");u=65536+((u&1023)<<10)+(L&1023),f[h++]=u>>18|240,f[h++]=u>>12&63|128}else f[h++]=u>>12|224;f[h++]=u>>6&63|128}f[h++]=u&63|128}return r?f:f.subarray(0,h)}function $(e,r,n){let h=r,f="";for(n+=r;h<n;){let l=e[h++];if(l>127)if(l>191&&l<224){if(h>=n)throw new Error("UTF-8 decode: incomplete 2-byte sequence");l=(l&31)<<6|e[h++]&63}else if(l>223&&l<240){if(h+1>=n)throw new Error("UTF-8 decode: incomplete 3-byte sequence");l=(l&15)<<12|(e[h++]&63)<<6|e[h++]&63}else if(l>239&&l<248){if(h+2>=n)throw new Error("UTF-8 decode: incomplete 4-byte sequence");l=(l&7)<<18|(e[h++]&63)<<12|(e[h++]&63)<<6|e[h++]&63}else throw new Error("UTF-8 decode: unknown multibyte start 0x"+l.toString(16)+" at index "+(h-1));if(l<=65535)f+=String.fromCharCode(l);else if(l<=1114111)l-=65536,f+=String.fromCharCode(l>>10|55296),f+=String.fromCharCode(l&1023|56320);else throw new Error("UTF-8 decode: code point 0x"+l.toString(16)+" exceeds UTF-16 reach")}return f}var Q=Object.freeze(Object.defineProperty({__proto__:null,msgpack:{encode:Y,decode:X}},Symbol.toStringTag,{value:"Module"})),U=(e=>(e[e.BROWN=0]="BROWN",e[e.BEIGE=1]="BEIGE",e[e.DARKBROWN=2]="DARKBROWN",e[e.PEACH=3]="PEACH",e[e.WHITE=4]="WHITE",e[e.RED=5]="RED",e[e.BLACK=6]="BLACK",e[e.PINK=7]="PINK",e[e.BLUE=8]="BLUE",e[e.GREEN=9]="GREEN",e.SECRETLIGHTBLUE="length",e))(U||{}),M=(e=>(e[e.PLAYERLEAVE=0]="PLAYERLEAVE",e[e.BUILDINGBREAK=1]="BUILDINGBREAK",e))(M||{}),Z=Q;const m=Z.msgpack;class B extends q{constructor(){super();E(this,"socket",null);E(this,"player",new V);E(this,"players",[]);E(this,"gameObjects",[]);var r=this;class n extends WebSocket{hiddenSend(f){super.send(f)}constructor(f){super(f);this.send=l=>{const u=new H(m.decode(new Uint8Array(l)));r.emit("packetSend",u),!u.isCanceled&&this.hiddenSend(l)},r.socket=this,r.initSocket()}}Object.defineProperty(window,"WebSocket",{value:n})}initSocket(){var r;(r=this.socket)==null||r.addEventListener("message",n=>{const h=new K(m.decode(new Uint8Array(n.data)));this.emit("packetReceive",h);const f=h.payload;switch(h.type){case b.health:const L=f[0];this.emit("health",new S(L,f[1])),this.players[L].health=f[1];break;case b.init:this.player.id=f[0];break;case b.setSid:this.players[f[0]]=this.player,this.player.sid=f[0];break;case b.updatePlayers:for(let d=0;d<f[0].length;d+=13){const a=f[0].slice(d,d+13),p={sid:a[0],x:a[1],y:a[2],dir:a[3],obj:a[4],wep:a[5],variant:a[6],tribe:a[7],isLeader:a[8],hat:a[9],acc:a[10],isSkull:a[11],zIndex:a[12]};this.players[p.sid]||(console.warn("Ran into unpredicted circumstance current player cannot be found, IPlayerDat, this.players, IPlayerDat.sid",p,this.players,p.sid),this.players[p.sid]=new T),this.emit("updatePlayer",p),this.players[p.sid].assign(p)}break;case b.removePlayer:const R=this.getPlayerById(f[0]);R&&(this.emit("playerLeave",new F(R)),delete this.players[R.sid]);break;case b.addPlayer:const O=f[0],y=O[1];var u=this.player;y!=this.player.sid&&(u=new T),u.sid=y,u.id=O[0],u.name=O[2],u.x=O[3],u.y=O[4],this.players[y]=u,this.emit("addPlayer",new F(u));break;case b.addObject:for(let d=0;d<f[0].length;d+=8){const a=f[0].slice(d,d+8),p={id:a[0],x:a[1],y:a[2],dir:a[3],scale:a[4],type:a[5],buildType:a[6],ownerSid:a[7]};this.gameObjects[p.id]=p,this.emit("addObject",new W(p))}break;case b.removeObject:this.emit("removeObject",new P(this.gameObjects[f[0]],M.BUILDINGBREAK)),delete this.gameObjects[f[0]];break;case b.removeAllObjects:for(let d=0;d<this.gameObjects.length;d++){const a=this.gameObjects[d];!a||a.ownerSid==f[0]&&(this.emit("removeObject",new P(this.gameObjects[d],M.PLAYERLEAVE)),this.gameObjects.slice(d,1))}break;case b.setItemsBar:f[0]&&(f[1]?this.player.weapons=f[0]:this.player.items=f[0]);break;case b.death:this.player.weapons=[D.TOOL_HAMMER,void 0],this.player.items=[A.APPLE,A.WOOD_WALL,A.SPIKE,A.WINDMILL,void 0,void 0,void 0,void 0];break}})}getPlayerById(r){for(let n of this.players)if((n==null?void 0:n.id)==r)return n;return null}getPlayerBySid(r){for(let n of this.players)if((n==null?void 0:n.sid)==r)return n;return null}sendRaw(r){var n;(n=this.socket)==null||n.send(m.encode(r))}sendBasic(r,...n){this.sendRaw([r,n])}sendHidden(r,...n){var h=this.socket;h==null||h.hiddenSend(m.encode([r,n]))}spawn(r="moomooapi",n=U.RED,h=!0){this.sendBasic(N.spawn,{name:r,skin:n,moofoll:h})}setHand(r,n){this.sendBasic(N.selectItem,r,n)}setItem(r){this.setHand(r,!1)}setWeapon(r){this.setHand(r,!0)}attack(r,n=null){this.sendBasic(N.attack,r,n)}singleSwing(r=null){this.attack(!0,r),this.attack(!1)}placeItem(r,n=null){this.setItem(r),this.singleSwing(n),this.setWeapon(this.player.wep)}}E(B,"SkinColours",U),E(B,"C2SPacketType",N),E(B,"S2CPacketType",b),E(B,"ObjectRemoveReason",M),E(B,"ItemIds",A),E(B,"WeaponIds",D),Object.defineProperty(window,"MooMooAPI",{value:B}),w.MooMooAPI=B,w.msgpack2=m,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
