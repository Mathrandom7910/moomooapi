var G=Object.defineProperty;var K=(g,a,U)=>a in g?G(g,a,{enumerable:!0,configurable:!0,writable:!0,value:U}):g[a]=U;var d=(g,a,U)=>(K(g,typeof a!="symbol"?a+"":a,U),U);(function(g,a){typeof exports=="object"&&typeof module!="undefined"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(g=typeof globalThis!="undefined"?globalThis:g||self,a(g.MMAPI={}))})(this,function(g){"use strict";class a{constructor(i){this.eventName=i}}class U extends a{constructor(i){super("packet");d(this,"payload");this.packet=i,this.payload=i[1]}}class O extends U{constructor(i){super(i);d(this,"type");this.type=i[0]}}class R extends U{constructor(i){super(i);d(this,"type");d(this,"isCanceled",!1);this.type=i[0]}}class q extends a{constructor(i,f){super("health");this.sid=i,this.health=f}}class L{constructor(i,f,c=!1){this.name=i,this.cb=f,this.once=c}}class _{constructor(){d(this,"events",[])}on(i,f){this.events.push(new L(i,f))}once(i,f){this.events.push(new L(i,f,!1))}emit(i,...f){this.events.filter(c=>c.name!=i?!0:(c.cb(...f),!c.once))}rmv(i){this.events.forEach(f=>{f.name==i&&(f.once=!0)})}}var j=(e=>(e.spawn="sp",e.chat="ch",e.attack="c",e.ping="pp",e.setAngle="2",e.selectItem="5",e.upgrade="6",e.autoAttack="7",e.createTribe="8",e.leaveTribe="9",e.requestJoinTribe="10",e.acceptTribeRequest="11",e.kickFromTribe="12",e.buyFromShop="13c",e.pingMap="14",e.move="33",e))(j||{}),E=(e=>(e.announce="ann",e.init="io-init",e.initTribe="id",e.setSid="1",e.kick="d",e.addPlayer="2",e.updatePlayers="33",e.removePlayer="4",e.updateLeaderBoard="5",e.addObject="6",e.updateAi="a",e.playerSwing="7",e.moostafaSwing="aa",e.wiggle="8",e.shootTurret="sp",e.updateMats="9",e.health="h",e.death="11",e.removeBuild="12",e.removeObject="13",e.setItemCount="14",e.setAge="15",e.listUpgrades="16",e.setItemsBar="17",e.addProjectile="18",e.removeProjectile="19",e.serverRestart="20",e.addTribe="ac",e.deleteTribe="ad",e.requestJoin="an",e.setTribe="st",e.setTribeMembers="sa",e.minimapLocation="mm",e.chat="ch",e.updateShop="us",e.ping="pp",e.dmgTest="t",e.pingMap="p",e))(E||{});class D{constructor(){d(this,"x",-2);d(this,"y",-2);d(this,"sid",-2);d(this,"id","NULL");d(this,"dir",0);d(this,"obj",-2);d(this,"wep",-2);d(this,"variant",-2);d(this,"tribe","NULL");d(this,"isLeader",!1);d(this,"hat",-2);d(this,"acc",-2);d(this,"isSkull",!1);d(this,"zIndex",-1);d(this,"health",100)}assign(i){this.x=i.x,this.y=i.y,this.sid=i.sid,this.dir=i.dir,this.obj=i.obj,this.wep=i.wep,this.variant=i.variant,this.tribe=i.tribe,this.isLeader=i.isLeader,this.hat=i.hat,this.acc=i.acc,this.isSkull=i.isSkull,this.zIndex=i.zIndex}}function N(e){let f,c,x=new Uint8Array(128),s=0;return u(e),x.subarray(0,s);function u(t){switch(typeof t){case"undefined":b();break;case"boolean":A(t);break;case"number":y(t);break;case"string":m(t);break;case"object":t===null?b():t instanceof Date?n(t):Array.isArray(t)?w(t):t instanceof Uint8Array||t instanceof Uint8ClampedArray?p(t):t instanceof Int8Array||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?w(t):B(t);break}}function b(t){h(192)}function A(t){h(t?195:194)}function y(t){if(isFinite(t)&&Math.floor(t)===t)if(t>=0&&t<=127)h(t);else if(t<0&&t>=-32)h(t);else if(t>0&&t<=255)o([204,t]);else if(t>=-128&&t<=127)o([208,t]);else if(t>0&&t<=65535)o([205,t>>>8,t]);else if(t>=-32768&&t<=32767)o([209,t>>>8,t]);else if(t>0&&t<=4294967295)o([206,t>>>24,t>>>16,t>>>8,t]);else if(t>=-2147483648&&t<=2147483647)o([210,t>>>24,t>>>16,t>>>8,t]);else if(t>0&&t<=18446744073709552e3){let r=t/4294967296,l=t%4294967296;o([211,r>>>24,r>>>16,r>>>8,r,l>>>24,l>>>16,l>>>8,l])}else t>=-9223372036854776e3&&t<=9223372036854776e3?(h(211),v(t)):t<0?o([211,128,0,0,0,0,0,0,0]):o([207,255,255,255,255,255,255,255,255]);else c||(f=new ArrayBuffer(8),c=new DataView(f)),c.setFloat64(0,t),h(203),o(new Uint8Array(f))}function m(t){let r=W(t),l=r.length;l<=31?h(160+l):l<=255?o([217,l]):l<=65535?o([218,l>>>8,l]):o([219,l>>>24,l>>>16,l>>>8,l]),o(r)}function w(t){let r=t.length;r<=15?h(144+r):r<=65535?o([220,r>>>8,r]):o([221,r>>>24,r>>>16,r>>>8,r]);for(let l=0;l<r;l++)u(t[l])}function p(t){let r=t.length;r<=15?o([196,r]):r<=65535?o([197,r>>>8,r]):o([198,r>>>24,r>>>16,r>>>8,r]),o(t)}function B(t){let r=0;for(let l in t)r++;r<=15?h(128+r):r<=65535?o([222,r>>>8,r]):o([223,r>>>24,r>>>16,r>>>8,r]);for(let l in t)u(l),u(t[l])}function n(t){let r=t.getTime()/1e3;if(t.getMilliseconds()===0&&r>=0&&r<4294967296)o([214,255,r>>>24,r>>>16,r>>>8,r]);else if(r>=0&&r<17179869184){let l=t.getMilliseconds()*1e6;o([215,255,l>>>22,l>>>14,l>>>6,l<<2>>>0|r/4294967296,r>>>24,r>>>16,r>>>8,r])}else{let l=t.getMilliseconds()*1e6;o([199,12,255,l>>>24,l>>>16,l>>>8,l]),v(r)}}function h(t){if(x.length<s+1){let r=x.length*2;for(;r<s+1;)r*=2;let l=new Uint8Array(r);l.set(x),x=l}x[s]=t,s++}function o(t){if(x.length<s+t.length){let r=x.length*2;for(;r<s+t.length;)r*=2;let l=new Uint8Array(r);l.set(x),x=l}x.set(t,s),s+=t.length}function v(t){let r,l;t>=0?(r=t/4294967296,l=t%4294967296):(t++,r=Math.abs(t)/4294967296,l=Math.abs(t)%4294967296,r=~r,l=~l),o([r>>>24,r>>>16,r>>>8,r,l>>>24,l>>>16,l>>>8,l])}}function V(e){let f=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),typeof e!="object"||typeof e.length=="undefined")throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!e.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");e instanceof Uint8Array||(e=new Uint8Array(e));let c=x();return f<e.length,c;function x(){const n=e[f++];if(n>=0&&n<=127)return n;if(n>=128&&n<=143)return y(n-128);if(n>=144&&n<=159)return m(n-144);if(n>=160&&n<=191)return w(n-160);if(n===192)return null;if(n===193)throw new Error("Invalid byte code 0xc1 found.");if(n===194)return!1;if(n===195)return!0;if(n===196)return A(-1,1);if(n===197)return A(-1,2);if(n===198)return A(-1,4);if(n===199)return p(-1,1);if(n===200)return p(-1,2);if(n===201)return p(-1,4);if(n===202)return b(4);if(n===203)return b(8);if(n===204)return u(1);if(n===205)return u(2);if(n===206)return u(4);if(n===207)return u(8);if(n===208)return s(1);if(n===209)return s(2);if(n===210)return s(4);if(n===211)return s(8);if(n===212)return p(1);if(n===213)return p(2);if(n===214)return p(4);if(n===215)return p(8);if(n===216)return p(16);if(n===217)return w(-1,1);if(n===218)return w(-1,2);if(n===219)return w(-1,4);if(n===220)return m(-1,2);if(n===221)return m(-1,4);if(n===222)return y(-1,2);if(n===223)return y(-1,4);if(n>=224&&n<=255)return n-256;throw console.debug("msgpack array:",e),new Error("Invalid byte value '"+n+"' at index "+(f-1)+" in the MessagePack binary data (length "+e.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function s(n){let h=0,o=!0;for(;n-- >0;)if(o){let v=e[f++];h+=v&127,v&128&&(h-=128),o=!1}else h*=256,h+=e[f++];return h}function u(n){let h=0;for(;n-- >0;)h*=256,h+=e[f++];return h}function b(n){let h=new DataView(e.buffer,f,n);if(f+=n,n===4)return h.getFloat32(0,!1);if(n===8)return h.getFloat64(0,!1)}function A(n,h){n<0&&(n=u(h));let o=e.subarray(f,f+n);return f+=n,o}function y(n,h){n<0&&(n=u(h));let o={};for(;n-- >0;){let v=x();o[v]=x()}return o}function m(n,h){n<0&&(n=u(h));let o=[];for(;n-- >0;)o.push(x());return o}function w(n,h){n<0&&(n=u(h));let o=f;return f+=n,H(e,o,n)}function p(n,h){n<0&&(n=u(h));let o=u(1),v=A(n);switch(o){case 255:return B(v)}return{type:o,data:v}}function B(n){if(n.length===4){let h=(n[0]<<24>>>0)+(n[1]<<16>>>0)+(n[2]<<8>>>0)+n[3];return new Date(h*1e3)}if(n.length===8){let h=(n[0]<<22>>>0)+(n[1]<<14>>>0)+(n[2]<<6>>>0)+(n[3]>>>2),o=(n[3]&3)*4294967296+(n[4]<<24>>>0)+(n[5]<<16>>>0)+(n[6]<<8>>>0)+n[7];return new Date(o*1e3+h/1e6)}if(n.length===12){let h=(n[0]<<24>>>0)+(n[1]<<16>>>0)+(n[2]<<8>>>0)+n[3];f-=8;let o=s(8);return new Date(o*1e3+h/1e6)}throw new Error("Invalid data length for a date value.")}}function W(e){let i=!0,f=e.length;for(let s=0;s<f;s++)if(e.charCodeAt(s)>127){i=!1;break}let c=0,x=new Uint8Array(e.length*(i?1:4));for(let s=0;s!==f;s++){let u=e.charCodeAt(s);if(u<128){x[c++]=u;continue}if(u<2048)x[c++]=u>>6|192;else{if(u>55295&&u<56320){if(++s>=f)throw new Error("UTF-8 encode: incomplete surrogate pair");let b=e.charCodeAt(s);if(b<56320||b>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+b.toString(16)+" at index "+s+" out of range");u=65536+((u&1023)<<10)+(b&1023),x[c++]=u>>18|240,x[c++]=u>>12&63|128}else x[c++]=u>>12|224;x[c++]=u>>6&63|128}x[c++]=u&63|128}return i?x:x.subarray(0,c)}function H(e,i,f){let c=i,x="";for(f+=i;c<f;){let s=e[c++];if(s>127)if(s>191&&s<224){if(c>=f)throw new Error("UTF-8 decode: incomplete 2-byte sequence");s=(s&31)<<6|e[c++]&63}else if(s>223&&s<240){if(c+1>=f)throw new Error("UTF-8 decode: incomplete 3-byte sequence");s=(s&15)<<12|(e[c++]&63)<<6|e[c++]&63}else if(s>239&&s<248){if(c+2>=f)throw new Error("UTF-8 decode: incomplete 4-byte sequence");s=(s&7)<<18|(e[c++]&63)<<12|(e[c++]&63)<<6|e[c++]&63}else throw new Error("UTF-8 decode: unknown multibyte start 0x"+s.toString(16)+" at index "+(c-1));if(s<=65535)x+=String.fromCharCode(s);else if(s<=1114111)s-=65536,x+=String.fromCharCode(s>>10|55296),x+=String.fromCharCode(s&1023|56320);else throw new Error("UTF-8 decode: code point 0x"+s.toString(16)+" exceeds UTF-16 reach")}return x}var J=Object.freeze(Object.defineProperty({__proto__:null,msgpack:{encode:N,decode:V}},Symbol.toStringTag,{value:"Module"})),M=(e=>(e[e.brown=0]="brown",e[e.beige=1]="beige",e[e.darkBrown=2]="darkBrown",e[e.peach=3]="peach",e[e.white=4]="white",e[e.red=5]="red",e[e.black=6]="black",e[e.pink=7]="pink",e[e.blue=8]="blue",e[e.green=9]="green",e.secretLightBlue="length",e))(M||{}),$=J;const F=$.msgpack;class I extends _{constructor(){super();d(this,"socket",null);d(this,"player",new D);d(this,"players",[]);var i=this;class f extends WebSocket{hiddenSend(x){super.send(x)}constructor(x){super(x);this.send=s=>{const u=new R(F.decode(new Uint8Array(s)));i.onPacketSend(u)||(i.emit("packetSend",u),this.hiddenSend(s))},i.socket=this,i.initSocket()}}Object.defineProperty(window,"WebSocket",{value:f})}initSocket(){var i;(i=this.socket)==null||i.addEventListener("message",f=>{var u;const c=new O(F.decode(new Uint8Array(f.data)));this.emit("packetReceive",c),this.onPacketReceive(c);const x=c.payload;switch(c.type){case E.health:const b=x[0],A=x[1];this.emit("health",new q(b,A));const y=this.players[b];y&&(y.health=A);break;case E.init:this.player.id=x[0];break;case E.setSid:this.players[x[0]]=this.player,this.player.sid=x[0];break;case E.updatePlayers:for(let m=0;m<x[0].length;m+=13){const w=x[0].slice(m,m+13),p={sid:w[0],x:w[1],y:w[2],dir:w[3],obj:w[4],wep:w[5],variant:w[6],tribe:w[7],isLeader:w[8],hat:w[9],acc:w[10],isSkull:w[11],zIndex:w[12]};this.players[p.sid]||(this.players[p.sid]=new D),(u=this.players[p.sid])==null||u.assign(p)}break}})}onPacketSend(i){return!1}onPacketReceive(i){}sendRaw(i){var f;(f=this.socket)==null||f.send(F.encode(i))}sendBasic(i,...f){this.sendRaw([i,f])}sendHidden(i,...f){var c=this.socket;c==null||c.hiddenSend(F.encode([i,f]))}spawn(i="moomooapi",f=M.red,c=!0){this.sendBasic(j.spawn,{name:i,skin:f,moofoll:c})}}d(I,"SkinColours",M),d(I,"C2SPacketType",j),d(I,"S2CPacketType",E),Object.defineProperty(window,"MooMooAPI",{value:I}),g.MooMooAPI=I,g.msgpack2=F,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
