(function(g,P){typeof exports=="object"&&typeof module!="undefined"?P(exports):typeof define=="function"&&define.amd?define(["exports"],P):(g=typeof globalThis!="undefined"?globalThis:g||self,P(g.MMAPI={}))})(this,function(g){"use strict";class P{constructor(t){this.eventName=t}}class a extends P{constructor(t){super("packet");this.packet=t,this.payload=t[1]}}class j extends a{constructor(t){super(t);this.type=t[0]}}class v extends a{constructor(t){super(t);this.isCanceled=!1,this.type=t[0]}}class K extends P{constructor(t){super("player");this.player=t}}class V extends P{constructor(t,E){super("health");this.sid=t,this.health=E}}class W extends P{constructor(t){super("build");this.building=t}}class H extends W{constructor(t){super(t)}}class m extends W{constructor(t,E){super(t);this.reason=E}}class Y extends P{constructor(t,E){super("chat");this.sid=t,this.message=E}}class F{constructor(t,E,s=!1){this.name=t,this.cb=E,this.once=s}}class J{constructor(){this.events=[]}on(t,E){this.events.push(new F(t,E))}once(t,E){this.events.push(new F(t,E,!0))}emit(t,E){this.events.filter(s=>s.name!=t?!0:(s.cb(E),!s.once))}removeEvent(t){this.events.forEach(E=>{E.name==t&&(E.once=!0)})}}var N=(e=>(e.SPAWN="sp",e.CHAT="ch",e.ATTACK="c",e.PING="pp",e.SET_ANGLE="2",e.SELECT_ITEM="5",e.UPGRADE="6",e.AUTO_ATTACK="7",e.CREATE_TRIBE="8",e.LEAVE_TRIBE="9",e.REQUEST_JOIN_TRIBE="10",e.ACCEPT_TRIBE_REQUEST="11",e.KICK_FROM_TRIBE="12",e.BUY_AND_EQUIP="13c",e.PING_MAP="14",e.MOVE="33",e))(N||{}),R=(e=>(e.ANNOUNCE="ann",e.INIT="io-init",e.INIT_TRIBES="id",e.SET_SID="1",e.KICK="d",e.ADD_PLAYER="2",e.UPDAE_PLAYERS="33",e.REMOVE_PLAYER="4",e.UPDATE_LEADER_BOARD="5",e.ADD_OBJECT="6",e.UPDATE_AIS="a",e.PLAYER_SWING="7",e.MOOSTAFA_SWING="aa",e.WIGGLE="8",e.SHOOT_TURRET="sp",e.UPDATE_MATS="9",e.HEALTH="h",e.DEATH="11",e.REMOVE_OBJECT="12",e.REMOVE_ALL_OBJECTS="13",e.SET_ITEM_COUNT="14",e.SET_AGE="15",e.LIST_UPGRADES="16",e.SET_ITEMS_BAR="17",e.ADD_PROJECTILE="18",e.REMOVE_PROJECTILE="19",e.SERVER_RESTART="20",e.ADD_TRIBE="ac",e.DELETE_TRIBE="ad",e.REQUEST_JOIN_TRIBE="an",e.SET_TRIBE="st",e.SET_TRIBE_MEMBERS="sa",e.MINIMAP_LOCATIONS="mm",e.CHAT="ch",e.UPDATE_SHOP="us",e.PING="pp",e.DAMAGE_TEST="t",e.PING_MAP="p",e))(R||{}),c=(e=>(e[e.APPLE=0]="APPLE",e[e.COOKIE=1]="COOKIE",e[e.CHEESE=2]="CHEESE",e[e.WOOD_WALL=3]="WOOD_WALL",e[e.STONE_WALL=4]="STONE_WALL",e[e.CASTLE_WALL=5]="CASTLE_WALL",e[e.SPIKE=6]="SPIKE",e[e.GREATER_SPIKE=7]="GREATER_SPIKE",e[e.POISON_SPIKE=8]="POISON_SPIKE",e[e.SPINNING_SPIKE=9]="SPINNING_SPIKE",e[e.WINDMILL=10]="WINDMILL",e[e.FASTER_WINDMILL=11]="FASTER_WINDMILL",e[e.POWER_MILL=12]="POWER_MILL",e[e.MINE=13]="MINE",e[e.SAPPLING=14]="SAPPLING",e[e.PIT_TRAP=15]="PIT_TRAP",e[e.BOOST_PAD=16]="BOOST_PAD",e[e.TURRET=17]="TURRET",e[e.PLATFORM=18]="PLATFORM",e[e.HEALING_PAD=19]="HEALING_PAD",e[e.SPAWN_PAD=20]="SPAWN_PAD",e[e.BLOCKER=21]="BLOCKER",e[e.TELEPORTER=22]="TELEPORTER",e))(c||{}),p=(e=>(e[e.TOOL_HAMMER=0]="TOOL_HAMMER",e[e.HAND_AXE=1]="HAND_AXE",e[e.GREAT_AXE=2]="GREAT_AXE",e[e.SHORT_SWORD=3]="SHORT_SWORD",e[e.KATANA=4]="KATANA",e[e.POLE_ARM=5]="POLE_ARM",e[e.BAT=6]="BAT",e[e.DAGGERS=7]="DAGGERS",e[e.STICK=8]="STICK",e[e.HUNTING_BOW=9]="HUNTING_BOW",e[e.GREAT_HAMMER=10]="GREAT_HAMMER",e[e.WOODEN_SHIELD=11]="WOODEN_SHIELD",e[e.CROSSBOW=12]="CROSSBOW",e[e.REPEATER_CROSSBOW=13]="REPEATER_CROSSBOW",e[e.MC_GRABBY=14]="MC_GRABBY",e[e.MUSKET=15]="MUSKET",e))(p||{});class b{constructor(){this.x=-2,this.y=-2,this.sid=-2,this.id="NULL",this.dir=0,this.currentObject=-2,this.wep=-2,this.variant=-2,this.tribe="NULL",this.isLeader=!1,this.hat=-2,this.acc=-2,this.isSkull=!1,this.zIndex=-1,this.health=100,this.name="NULL",this.chatMessage=null,this.messageTimeout=-1}assign(t){this.x=t.x,this.y=t.y,this.sid=t.sid,this.dir=t.dir,this.currentObject=t.currentObject,this.wep=t.wep,this.variant=t.variant,this.tribe=t.tribe,this.isLeader=t.isLeader,this.hat=t.hat,this.acc=t.acc,this.isSkull=t.isSkull,this.zIndex=t.zIndex}}class X extends b{constructor(){super(...arguments);this.weapons=[p.TOOL_HAMMER,void 0],this.items=[c.APPLE,c.WOOD_WALL,c.SPIKE,c.WINDMILL,void 0,void 0,void 0,void 0]}getFoodType(){return this.items[0]}getWallType(){return this.items[1]}getSpikeType(){return this.items[2]}getMillType(){return this.items[3]}searchForId(t){for(let E of this.items)if(E==t)return E;return null}getSapplingType(){return this.searchForId(c.SAPPLING)}getMineType(){return this.searchForId(c.MINE)}getSpecialType(){return this.searchForId(c.TURRET)||this.searchForId(c.BLOCKER)||this.searchForId(c.HEALING_PAD)||this.searchForId(c.PLATFORM)||this.searchForId(c.TELEPORTER)}getPadType(){return this.items[4]||null}getPrimaryType(){return this.weapons[0]}getSecondaryType(){return this.weapons[1]}}function d(e){let E,s,l=new Uint8Array(128),A=0;return _(e),l.subarray(0,A);function _(i){switch(typeof i){case"undefined":u();break;case"boolean":S(i);break;case"number":D(i);break;case"string":x(i);break;case"object":i===null?u():i instanceof Date?n(i):Array.isArray(i)?M(i):i instanceof Uint8Array||i instanceof Uint8ClampedArray?T(i):i instanceof Int8Array||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array?M(i):B(i);break}}function u(i){o(192)}function S(i){o(i?195:194)}function D(i){if(isFinite(i)&&Math.floor(i)===i)if(i>=0&&i<=127)o(i);else if(i<0&&i>=-32)o(i);else if(i>0&&i<=255)h([204,i]);else if(i>=-128&&i<=127)h([208,i]);else if(i>0&&i<=65535)h([205,i>>>8,i]);else if(i>=-32768&&i<=32767)h([209,i>>>8,i]);else if(i>0&&i<=4294967295)h([206,i>>>24,i>>>16,i>>>8,i]);else if(i>=-2147483648&&i<=2147483647)h([210,i>>>24,i>>>16,i>>>8,i]);else if(i>0&&i<=18446744073709552e3){let r=i/4294967296,f=i%4294967296;h([211,r>>>24,r>>>16,r>>>8,r,f>>>24,f>>>16,f>>>8,f])}else i>=-9223372036854776e3&&i<=9223372036854776e3?(o(211),O(i)):i<0?h([211,128,0,0,0,0,0,0,0]):h([207,255,255,255,255,255,255,255,255]);else s||(E=new ArrayBuffer(8),s=new DataView(E)),s.setFloat64(0,i),o(203),h(new Uint8Array(E))}function x(i){let r=Q(i),f=r.length;f<=31?o(160+f):f<=255?h([217,f]):f<=65535?h([218,f>>>8,f]):h([219,f>>>24,f>>>16,f>>>8,f]),h(r)}function M(i){let r=i.length;r<=15?o(144+r):r<=65535?h([220,r>>>8,r]):h([221,r>>>24,r>>>16,r>>>8,r]);for(let f=0;f<r;f++)_(i[f])}function T(i){let r=i.length;r<=15?h([196,r]):r<=65535?h([197,r>>>8,r]):h([198,r>>>24,r>>>16,r>>>8,r]),h(i)}function B(i){let r=0;for(let f in i)r++;r<=15?o(128+r):r<=65535?h([222,r>>>8,r]):h([223,r>>>24,r>>>16,r>>>8,r]);for(let f in i)_(f),_(i[f])}function n(i){let r=i.getTime()/1e3;if(i.getMilliseconds()===0&&r>=0&&r<4294967296)h([214,255,r>>>24,r>>>16,r>>>8,r]);else if(r>=0&&r<17179869184){let f=i.getMilliseconds()*1e6;h([215,255,f>>>22,f>>>14,f>>>6,f<<2>>>0|r/4294967296,r>>>24,r>>>16,r>>>8,r])}else{let f=i.getMilliseconds()*1e6;h([199,12,255,f>>>24,f>>>16,f>>>8,f]),O(r)}}function o(i){if(l.length<A+1){let r=l.length*2;for(;r<A+1;)r*=2;let f=new Uint8Array(r);f.set(l),l=f}l[A]=i,A++}function h(i){if(l.length<A+i.length){let r=l.length*2;for(;r<A+i.length;)r*=2;let f=new Uint8Array(r);f.set(l),l=f}l.set(i,A),A+=i.length}function O(i){let r,f;i>=0?(r=i/4294967296,f=i%4294967296):(i++,r=Math.abs(i)/4294967296,f=Math.abs(i)%4294967296,r=~r,f=~f),h([r>>>24,r>>>16,r>>>8,r,f>>>24,f>>>16,f>>>8,f])}}function q(e){let E=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),typeof e!="object"||typeof e.length=="undefined")throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!e.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");e instanceof Uint8Array||(e=new Uint8Array(e));let s=l();return E<e.length,s;function l(){const n=e[E++];if(n>=0&&n<=127)return n;if(n>=128&&n<=143)return D(n-128);if(n>=144&&n<=159)return x(n-144);if(n>=160&&n<=191)return M(n-160);if(n===192)return null;if(n===193)throw new Error("Invalid byte code 0xc1 found.");if(n===194)return!1;if(n===195)return!0;if(n===196)return S(-1,1);if(n===197)return S(-1,2);if(n===198)return S(-1,4);if(n===199)return T(-1,1);if(n===200)return T(-1,2);if(n===201)return T(-1,4);if(n===202)return u(4);if(n===203)return u(8);if(n===204)return _(1);if(n===205)return _(2);if(n===206)return _(4);if(n===207)return _(8);if(n===208)return A(1);if(n===209)return A(2);if(n===210)return A(4);if(n===211)return A(8);if(n===212)return T(1);if(n===213)return T(2);if(n===214)return T(4);if(n===215)return T(8);if(n===216)return T(16);if(n===217)return M(-1,1);if(n===218)return M(-1,2);if(n===219)return M(-1,4);if(n===220)return x(-1,2);if(n===221)return x(-1,4);if(n===222)return D(-1,2);if(n===223)return D(-1,4);if(n>=224&&n<=255)return n-256;throw console.debug("msgpack array:",e),new Error("Invalid byte value '"+n+"' at index "+(E-1)+" in the MessagePack binary data (length "+e.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function A(n){let o=0,h=!0;for(;n-- >0;)if(h){let O=e[E++];o+=O&127,O&128&&(o-=128),h=!1}else o*=256,o+=e[E++];return o}function _(n){let o=0;for(;n-- >0;)o*=256,o+=e[E++];return o}function u(n){let o=new DataView(e.buffer,E,n);if(E+=n,n===4)return o.getFloat32(0,!1);if(n===8)return o.getFloat64(0,!1)}function S(n,o){n<0&&(n=_(o));let h=e.subarray(E,E+n);return E+=n,h}function D(n,o){n<0&&(n=_(o));let h={};for(;n-- >0;){let O=l();h[O]=l()}return h}function x(n,o){n<0&&(n=_(o));let h=[];for(;n-- >0;)h.push(l());return h}function M(n,o){n<0&&(n=_(o));let h=E;return E+=n,Z(e,h,n)}function T(n,o){n<0&&(n=_(o));let h=_(1),O=S(n);switch(h){case 255:return B(O)}return{type:h,data:O}}function B(n){if(n.length===4){let o=(n[0]<<24>>>0)+(n[1]<<16>>>0)+(n[2]<<8>>>0)+n[3];return new Date(o*1e3)}if(n.length===8){let o=(n[0]<<22>>>0)+(n[1]<<14>>>0)+(n[2]<<6>>>0)+(n[3]>>>2),h=(n[3]&3)*4294967296+(n[4]<<24>>>0)+(n[5]<<16>>>0)+(n[6]<<8>>>0)+n[7];return new Date(h*1e3+o/1e6)}if(n.length===12){let o=(n[0]<<24>>>0)+(n[1]<<16>>>0)+(n[2]<<8>>>0)+n[3];E-=8;let h=A(8);return new Date(h*1e3+o/1e6)}throw new Error("Invalid data length for a date value.")}}function Q(e){let t=!0,E=e.length;for(let A=0;A<E;A++)if(e.charCodeAt(A)>127){t=!1;break}let s=0,l=new Uint8Array(e.length*(t?1:4));for(let A=0;A!==E;A++){let _=e.charCodeAt(A);if(_<128){l[s++]=_;continue}if(_<2048)l[s++]=_>>6|192;else{if(_>55295&&_<56320){if(++A>=E)throw new Error("UTF-8 encode: incomplete surrogate pair");let u=e.charCodeAt(A);if(u<56320||u>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+u.toString(16)+" at index "+A+" out of range");_=65536+((_&1023)<<10)+(u&1023),l[s++]=_>>18|240,l[s++]=_>>12&63|128}else l[s++]=_>>12|224;l[s++]=_>>6&63|128}l[s++]=_&63|128}return t?l:l.subarray(0,s)}function Z(e,t,E){let s=t,l="";for(E+=t;s<E;){let A=e[s++];if(A>127)if(A>191&&A<224){if(s>=E)throw new Error("UTF-8 decode: incomplete 2-byte sequence");A=(A&31)<<6|e[s++]&63}else if(A>223&&A<240){if(s+1>=E)throw new Error("UTF-8 decode: incomplete 3-byte sequence");A=(A&15)<<12|(e[s++]&63)<<6|e[s++]&63}else if(A>239&&A<248){if(s+2>=E)throw new Error("UTF-8 decode: incomplete 4-byte sequence");A=(A&7)<<18|(e[s++]&63)<<12|(e[s++]&63)<<6|e[s++]&63}else throw new Error("UTF-8 decode: unknown multibyte start 0x"+A.toString(16)+" at index "+(s-1));if(A<=65535)l+=String.fromCharCode(A);else if(A<=1114111)A-=65536,l+=String.fromCharCode(A>>10|55296),l+=String.fromCharCode(A&1023|56320);else throw new Error("UTF-8 decode: code point 0x"+A.toString(16)+" exceeds UTF-16 reach")}return l}var $=Object.freeze(Object.defineProperty({__proto__:null,msgpack:{encode:d,decode:q}},Symbol.toStringTag,{value:"Module"})),U=(e=>(e[e.BROWN=0]="BROWN",e[e.BEIGE=1]="BEIGE",e[e.DARKBROWN=2]="DARKBROWN",e[e.PEACH=3]="PEACH",e[e.WHITE=4]="WHITE",e[e.RED=5]="RED",e[e.BLACK=6]="BLACK",e[e.PINK=7]="PINK",e[e.BLUE=8]="BLUE",e[e.GREEN=9]="GREEN",e.SECRETLIGHTBLUE="length",e))(U||{});class k{constructor(t,E,s){this.cb=t,this.msInterval=E,this.keyCode=s,this.intervalId=null}start(t){this.keyCode!=t||this.intervalId!=null||(this.intervalId=setInterval(this.cb,this.msInterval))}stop(t){this.keyCode!=t||this.intervalId==null||(clearInterval(this.intervalId),this.intervalId=null)}}var G=(e=>(e[e.PLAYERLEAVE=0]="PLAYERLEAVE",e[e.BUILDINGBREAK=1]="BUILDINGBREAK",e))(G||{}),y=(e=>(e[e.SHAME=45]="SHAME",e[e.MOO_CAP=51]="MOO_CAP",e[e.APPLE_CAP=50]="APPLE_CAP",e[e.MOO_HEAD=28]="MOO_HEAD",e[e.PIG_HEAD=29]="PIG_HEAD",e[e.FLUFF_HEAD=30]="FLUFF_HEAD",e[e.PANDOU_HEAD=36]="PANDOU_HEAD",e[e.BEAR_HEAD=37]="BEAR_HEAD",e[e.MONKEY_HEAD=38]="MONKEY_HEAD",e[e.POLAR_HEAD=44]="POLAR_HEAD",e[e.FEZ_HAT=35]="FEZ_HAT",e[e.ENIGMA_HAT=42]="ENIGMA_HAT",e[e.BLITZ_HAT=43]="BLITZ_HAT",e[e.BOB_XIII_HAT=49]="BOB_XIII_HAT",e[e.PUMPKIN=57]="PUMPKIN",e[e.BUMMLE_HAT=8]="BUMMLE_HAT",e[e.STRAW_HAT=2]="STRAW_HAT",e[e.WINTER_CAP=15]="WINTER_CAP",e[e.COWBOY_HAT=5]="COWBOY_HAT",e[e.RANGER_HAT=4]="RANGER_HAT",e[e.EXPLORER_HAT=18]="EXPLORER_HAT",e[e.FLIPPER_HAT=31]="FLIPPER_HAT",e[e.MARKSMAN_CAP=1]="MARKSMAN_CAP",e[e.BUSH_GEAR=10]="BUSH_GEAR",e[e.HALO=48]="HALO",e[e.SOLDIER_HELMET=6]="SOLDIER_HELMET",e[e.ANTI_VENOM_GEAR=23]="ANTI_VENOM_GEAR",e[e.MEDIC_GEAR=13]="MEDIC_GEAR",e[e.MINERS_HELMET=9]="MINERS_HELMET",e[e.MUSKETEER_HAT=32]="MUSKETEER_HAT",e[e.BULL_HELMET=7]="BULL_HELMET",e[e.EMP_HELMET=22]="EMP_HELMET",e[e.BOOSTER_HAT=12]="BOOSTER_HAT",e[e.BARBARIAN_ARMOR=26]="BARBARIAN_ARMOR",e[e.PLAGUE_MASK=21]="PLAGUE_MASK",e[e.BULL_MASK=46]="BULL_MASK",e[e.WINDMILL_HAT=14]="WINDMILL_HAT",e[e.SPIKE_GEAR=11]="SPIKE_GEAR",e[e.TURRET_GEAR=53]="TURRET_GEAR",e[e.SAMURAI_ARMOR=20]="SAMURAI_ARMOR",e[e.DARK_KNIGHT=58]="DARK_KNIGHT",e[e.SCAVENGER_GEAR=27]="SCAVENGER_GEAR",e[e.TANK_GEAR=40]="TANK_GEAR",e[e.THIEF_GEAR=40]="THIEF_GEAR",e[e.BLOODTHIRSTER=55]="BLOODTHIRSTER",e[e.Assassin_GEAR=56]="Assassin_GEAR",e))(y||{}),C=(e=>(e[e.SNOWBALL=12]="SNOWBALL",e[e.TREE_CAPE=9]="TREE_CAPE",e[e.STONE_CAPE=10]="STONE_CAPE",e[e.COOKIE_CAPE=3]="COOKIE_CAPE",e[e.COW_CAPE=8]="COW_CAPE",e[e.MONKEY_TAIL=11]="MONKEY_TAIL",e[e.APPLE_BASKET=17]="APPLE_BASKET",e[e.WINTER_CAPE=6]="WINTER_CAPE",e[e.SKULL_CAPE=4]="SKULL_CAPE",e[e.DASH_CAPE=5]="DASH_CAPE",e[e.DRAGON_CAPE=2]="DRAGON_CAPE",e[e.SUPER_CAPE=1]="SUPER_CAPE",e[e.TROLL_CAPE=7]="TROLL_CAPE",e[e.THORNS=14]="THORNS",e[e.BLOCKADES=15]="BLOCKADES",e[e.DEVILS_TAIL=20]="DEVILS_TAIL",e[e.SAWBLADE=16]="SAWBLADE",e[e.ANGEL_WINGS=13]="ANGEL_WINGS",e[e.SHADOW_WINGS=19]="SHADOW_WINGS",e[e.BLOOD_WINGS=18]="BLOOD_WINGS",e[e.CORRUPT_X_WINGS=21]="CORRUPT_X_WINGS",e))(C||{}),z=$;const w=z.msgpack;class L extends J{constructor(t=!1){super();this.socket=null,this.player=new X,this.players=[],this.gameObjects=[],this.alive=!1,this.hatsOwned={},this.accessoriesOwned={};const E=this;if(t)Object.defineProperty(WebSocket.prototype,"hiddenSend",{value:WebSocket.prototype.send}),Object.defineProperty(WebSocket.prototype,"send",{value:function(s){E.socket==null&&(E.socket=this);const l=new v(w.decode(new Uint8Array(s)));if(E.emit("packetSend",l),l.isCanceled)return;l.type==N.SPAWN&&(E.alive=!0),this.hiddenSend(s)}});else{class s extends WebSocket{hiddenSend(A){super.send(A)}constructor(A){super(A);this.send=_=>{const u=new v(w.decode(new Uint8Array(_)));E.emit("packetSend",u),!u.isCanceled&&(u.type==N.SPAWN&&(E.alive=!0),this.hiddenSend(_))},E.socket=this,E.initSocket()}}Object.defineProperty(window,"WebSocket",{value:s})}}initSocket(){var t;(t=this.socket)==null||t.addEventListener("message",E=>{const s=new j(w.decode(new Uint8Array(E.data)));this.emit("packetReceive",s);const l=s.payload;switch(s.type){case R.HEALTH:const S=l[0];this.emit("health",new V(S,l[1])),this.players[S].health=l[1];break;case R.INIT:this.player.id=l[0];break;case R.SET_SID:this.players[l[0]]=this.player,this.player.sid=l[0];break;case R.UPDAE_PLAYERS:this.emit("serverTick",s);var _=[];for(let i=0;i<l[0].length;i+=13){const r=l[0].slice(i,i+13),f={sid:r[0],x:r[1],y:r[2],dir:r[3],currentObject:r[4],wep:r[5],variant:r[6],tribe:r[7],isLeader:r[8],hat:r[9],acc:r[10],isSkull:r[11],zIndex:r[12]};this.players[f.sid]||(console.warn("Ran into unpredicted circumstance current player cannot be found, IPlayerDat, this.players, IPlayerDat.sid",f,this.players,f.sid),this.players[f.sid]=new b),this.emit("updatePlayer",f),this.players[f.sid].assign(f),_.push(f)}break;case R.REMOVE_PLAYER:const D=this.getPlayerById(l[0]);D&&(this.emit("playerLeave",new K(D)),delete this.players[D.sid]);break;case R.ADD_PLAYER:const x=l[0],M=x[1];var u=this.player;M!=this.player.sid&&(u=new b),u.sid=M,u.id=x[0],u.name=x[2],u.x=x[3],u.y=x[4],this.players[M]=u,this.emit("addPlayer",new K(u));break;case R.ADD_OBJECT:for(let i=0;i<l[0].length;i+=8){const r=l[0].slice(i,i+8),f={id:r[0],x:r[1],y:r[2],dir:r[3],scale:r[4],type:r[5],buildType:r[6],ownerSid:r[7]};this.gameObjects[f.id]=f,this.emit("addObject",new H(f))}break;case R.REMOVE_OBJECT:this.emit("removeObject",new m(this.gameObjects[l[0]],G.BUILDINGBREAK)),delete this.gameObjects[l[0]];break;case R.REMOVE_ALL_OBJECTS:for(let i=0;i<this.gameObjects.length;i++){const r=this.gameObjects[i];!r||r.ownerSid==l[0]&&(this.emit("removeObject",new m(this.gameObjects[i],G.PLAYERLEAVE)),this.gameObjects.slice(i,1))}break;case R.SET_ITEMS_BAR:l[0]&&(l[1]?this.player.weapons=l[0]:this.player.items=l[0]);break;case R.DEATH:this.player.weapons=[p.TOOL_HAMMER,void 0],this.player.items=[c.APPLE,c.WOOD_WALL,c.SPIKE,c.WINDMILL,void 0,void 0,void 0,void 0];break;case R.CHAT:const T=l[0],B=this.getPlayerBySid(T);if(B==null)return;const n=l[1];clearTimeout(B.messageTimeout),B.chatMessage=n,B.messageTimeout=setTimeout(()=>{B.chatMessage=null},3e3),this.emit("chat",new Y(T,n));break;case R.UPDATE_SHOP:if(l[0])break;const h=l[2],O=l[1];h?this.accessoriesOwned[O]=!0:this.hatsOwned[O]=!0;break}})}getPlayerById(t){for(let E of this.players)if((E==null?void 0:E.id)==t)return E;return null}getPlayerBySid(t){for(let E of this.players)if((E==null?void 0:E.sid)==t)return E;return null}sendRaw(t){var E;(E=this.socket)==null||E.send(w.encode(t))}sendBasic(t,...E){this.sendRaw([t,E])}sendHidden(t,...E){var s=this.socket;s==null||s.hiddenSend(w.encode([t,E]))}spawn(t="moomooapi",E=U.RED,s=!0){this.sendBasic(N.SPAWN,{name:t,skin:E,moofoll:s})}setHand(t,E){this.sendBasic(N.SELECT_ITEM,t,E)}setItem(t){this.setHand(t,!1)}setWeapon(t){this.setHand(t,!0)}attack(t,E=null){this.sendBasic(N.ATTACK,t,E)}singleSwing(t=null){this.attack(!0,t),this.attack(!1)}placeItem(t,E=null){this.setItem(t),this.singleSwing(E),this.setWeapon(this.player.wep)}toggleAutoFire(){this.sendBasic(N.AUTO_ATTACK,1)}setGear(t,E,s){this.sendBasic(N.BUY_AND_EQUIP,t,E,s)}buyGear(t,E){this.setGear(!0,t,E)}buyHat(t){this.buyGear(t,!1)}equipGear(t,E){this.setGear(!1,t,E)}equipHat(t){this.equipGear(t,!1)}buyAccessory(t){this.buyGear(t,!0)}equipAccessory(t){this.equipGear(t,!0)}chat(t){this.sendBasic(N.CHAT,t)}}L.SkinColours=U,L.C2SPacketType=N,L.S2CPacketType=R,L.ObjectRemoveReason=G,L.ItemIds=c,L.WeaponIds=p,L.Repeater=k,L.msgpack=w,L.HatIds=y,L.AccessoryIds=C,Object.defineProperty(window,"MooMooAPI",{value:L}),g.MooMooAPI=L,g.msgpack2=w,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
