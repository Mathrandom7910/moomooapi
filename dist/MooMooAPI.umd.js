(function(de,fe){typeof exports=="object"&&typeof module!="undefined"?fe(exports):typeof define=="function"&&define.amd?define(["exports"],fe):(de=typeof globalThis!="undefined"?globalThis:de||self,fe(de.MMAPI={}))})(this,function(de){"use strict";var fe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Te={};Object.defineProperty(Te,"__esModule",{value:!0});var Se=Te.Pos=Te.PrimitivePos=void 0;class qe{constructor(r=0,t=0){this.x=r,this.y=t}normalize(){return new ge(this.x,this.y)}}Te.PrimitivePos=qe;class ge extends qe{constructor(r=0,t=0){super(r,t),this.x=r,this.y=t}clone(){return new ge(this.x,this.y)}addX(r){const t=this.clone();return t.x+=r,t}addY(r){const t=this.clone();return t.y+=r,t}add(r,t){return r instanceof ge?this.addX(r.x).addY(r.y):this.addX(r).addY(t||0)}toString(){return`X: ${this.x} Y: ${this.y}`}asPrimitive(){return new qe(this.x,this.y)}}Se=Te.Pos=ge;class te{constructor(r){this.eventName=r}}class _r extends te{constructor(r){super("packet"),this.packet=r,this.payload=r[1]}}class Rt extends _r{constructor(r){super(r),this.type=r[0]}}class Br extends _r{constructor(r){super(r),this.isCanceled=!1,this.type=r[0]}}class yr extends te{constructor(r){super("player"),this.player=r}}class mt extends te{constructor(r,t){super("health"),this.sid=r,this.health=t}}class Rr extends te{constructor(r){super("build"),this.building=r}}class wt extends Rr{constructor(r){super(r)}}class mr extends Rr{constructor(r,t){super(r),this.reason=t}getAsPos(){throw new Se(this.building.x,this.building.y)}}class bt extends te{constructor(r,t){super("chat"),this.sid=r,this.message=t}}class Tt extends te{constructor(r){super("server_tick"),this.playerData=r}}class gt extends te{constructor(r){super("projectile_add"),this.projectile=r}}class Ot extends te{constructor(r){super("projectile_remove"),this.projectile=r}}class wr{constructor(r,t,i=!1){this.name=r,this.cb=t,this.once=i}}class Pt{constructor(){this.events=[]}on(r,t){this.events.push(new wr(r,t))}once(r,t){this.events.push(new wr(r,t,!0))}emit(r,t){this.events.filter(i=>i.name!=r?!0:(i.cb(t),!i.once))}removeEvent(r){this.events.forEach(t=>{t.name==r&&(t.once=!0)})}}var J=(e=>(e.SPAWN="sp",e.CHAT="ch",e.ATTACK="c",e.PING="pp",e.SET_ANGLE="2",e.SELECT_ITEM="5",e.UPGRADE="6",e.AUTO_ATTACK="7",e.CREATE_TRIBE="8",e.LEAVE_TRIBE="9",e.REQUEST_JOIN_TRIBE="10",e.ACCEPT_TRIBE_REQUEST="11",e.KICK_FROM_TRIBE="12",e.BUY_AND_EQUIP="13c",e.PING_MAP="14",e.MOVE="33",e))(J||{}),U=(e=>(e.ANNOUNCE="ann",e.INIT="io-init",e.INIT_TRIBES="id",e.SET_SID="1",e.KICK="d",e.ADD_PLAYER="2",e.UPDAE_PLAYERS="33",e.REMOVE_PLAYER="4",e.UPDATE_LEADER_BOARD="5",e.ADD_OBJECT="6",e.UPDATE_AIS="a",e.PLAYER_SWING="7",e.MOOSTAFA_SWING="aa",e.WIGGLE="8",e.SHOOT_TURRET="sp",e.UPDATE_MATS="9",e.HEALTH="h",e.DEATH="11",e.REMOVE_OBJECT="12",e.REMOVE_ALL_OBJECTS="13",e.SET_ITEM_COUNT="14",e.SET_AGE="15",e.LIST_UPGRADES="16",e.SET_ITEMS_BAR="17",e.ADD_PROJECTILE="18",e.REMOVE_PROJECTILE="19",e.SERVER_RESTART="20",e.ADD_TRIBE="ac",e.DELETE_TRIBE="ad",e.REQUEST_JOIN_TRIBE="an",e.SET_TRIBE="st",e.SET_TRIBE_MEMBERS="sa",e.MINIMAP_LOCATIONS="mm",e.CHAT="ch",e.UPDATE_SHOP="us",e.PING="pp",e.DAMAGE_TEST="t",e.PING_MAP="p",e))(U||{}),M=(e=>(e[e.APPLE=0]="APPLE",e[e.COOKIE=1]="COOKIE",e[e.CHEESE=2]="CHEESE",e[e.WOOD_WALL=3]="WOOD_WALL",e[e.STONE_WALL=4]="STONE_WALL",e[e.CASTLE_WALL=5]="CASTLE_WALL",e[e.SPIKE=6]="SPIKE",e[e.GREATER_SPIKE=7]="GREATER_SPIKE",e[e.POISON_SPIKE=8]="POISON_SPIKE",e[e.SPINNING_SPIKE=9]="SPINNING_SPIKE",e[e.WINDMILL=10]="WINDMILL",e[e.FASTER_WINDMILL=11]="FASTER_WINDMILL",e[e.POWER_MILL=12]="POWER_MILL",e[e.MINE=13]="MINE",e[e.SAPPLING=14]="SAPPLING",e[e.PIT_TRAP=15]="PIT_TRAP",e[e.BOOST_PAD=16]="BOOST_PAD",e[e.TURRET=17]="TURRET",e[e.PLATFORM=18]="PLATFORM",e[e.HEALING_PAD=19]="HEALING_PAD",e[e.SPAWN_PAD=20]="SPAWN_PAD",e[e.BLOCKER=21]="BLOCKER",e[e.TELEPORTER=22]="TELEPORTER",e))(M||{}),Ue=(e=>(e[e.TOOL_HAMMER=0]="TOOL_HAMMER",e[e.HAND_AXE=1]="HAND_AXE",e[e.GREAT_AXE=2]="GREAT_AXE",e[e.SHORT_SWORD=3]="SHORT_SWORD",e[e.KATANA=4]="KATANA",e[e.POLE_ARM=5]="POLE_ARM",e[e.BAT=6]="BAT",e[e.DAGGERS=7]="DAGGERS",e[e.STICK=8]="STICK",e[e.HUNTING_BOW=9]="HUNTING_BOW",e[e.GREAT_HAMMER=10]="GREAT_HAMMER",e[e.WOODEN_SHIELD=11]="WOODEN_SHIELD",e[e.CROSSBOW=12]="CROSSBOW",e[e.REPEATER_CROSSBOW=13]="REPEATER_CROSSBOW",e[e.MC_GRABBY=14]="MC_GRABBY",e[e.MUSKET=15]="MUSKET",e))(Ue||{});class Qe{constructor(){this.x=-2,this.y=-2,this.sid=-2,this.id="NULL",this.dir=0,this.currentObject=-2,this.wep=-2,this.variant=-2,this.tribe="NULL",this.isLeader=!1,this.hat=-2,this.acc=-2,this.isSkull=!1,this.zIndex=-1,this.health=100,this.name="NULL",this.chatMessage=null,this.messageTimeout=-1}assign(r){this.x=r.x,this.y=r.y,this.sid=r.sid,this.dir=r.dir,this.currentObject=r.currentObject,this.wep=r.wep,this.variant=r.variant,this.tribe=r.tribe,this.isLeader=r.isLeader,this.hat=r.hat,this.acc=r.acc,this.isSkull=r.isSkull,this.zIndex=r.zIndex}getAsPos(){return new Se(this.x,this.y)}}class Lt extends Qe{constructor(){super(...arguments),this.weapons=[Ue.TOOL_HAMMER,void 0],this.items=[M.APPLE,M.WOOD_WALL,M.SPIKE,M.WINDMILL,void 0,void 0,void 0,void 0]}getFoodType(){return this.items[0]}getWallType(){return this.items[1]}getSpikeType(){return this.items[2]}getMillType(){return this.items[3]}searchForId(r){for(let t of this.items)if(t==r)return t;return null}getSapplingType(){return this.searchForId(M.SAPPLING)}getMineType(){return this.searchForId(M.MINE)}getSpecialType(){return this.searchForId(M.TURRET)||this.searchForId(M.BLOCKER)||this.searchForId(M.HEALING_PAD)||this.searchForId(M.PLATFORM)||this.searchForId(M.TELEPORTER)}getPadType(){return this.items[4]||null}getPrimaryType(){return this.weapons[0]}getSecondaryType(){return this.weapons[1]}}var er=(e=>(e[e.BROWN=0]="BROWN",e[e.BEIGE=1]="BEIGE",e[e.DARKBROWN=2]="DARKBROWN",e[e.PEACH=3]="PEACH",e[e.WHITE=4]="WHITE",e[e.RED=5]="RED",e[e.BLACK=6]="BLACK",e[e.PINK=7]="PINK",e[e.BLUE=8]="BLUE",e[e.GREEN=9]="GREEN",e.SECRETLIGHTBLUE="length",e))(er||{});class St{constructor(r,t,i){this.cb=r,this.msInterval=t,this.keyCode=i,this.intervalId=null}start(r){this.keyCode!=r||this.intervalId!=null||(this.intervalId=setInterval(this.cb,this.msInterval))}stop(r){this.keyCode!=r||this.intervalId==null||(clearInterval(this.intervalId),this.intervalId=null)}}var Me=(e=>(e[e.PLAYERLEAVE=0]="PLAYERLEAVE",e[e.BUILDINGBREAK=1]="BUILDINGBREAK",e))(Me||{}),br=(e=>(e[e.SHAME=45]="SHAME",e[e.MOO_CAP=51]="MOO_CAP",e[e.APPLE_CAP=50]="APPLE_CAP",e[e.MOO_HEAD=28]="MOO_HEAD",e[e.PIG_HEAD=29]="PIG_HEAD",e[e.FLUFF_HEAD=30]="FLUFF_HEAD",e[e.PANDOU_HEAD=36]="PANDOU_HEAD",e[e.BEAR_HEAD=37]="BEAR_HEAD",e[e.MONKEY_HEAD=38]="MONKEY_HEAD",e[e.POLAR_HEAD=44]="POLAR_HEAD",e[e.FEZ_HAT=35]="FEZ_HAT",e[e.ENIGMA_HAT=42]="ENIGMA_HAT",e[e.BLITZ_HAT=43]="BLITZ_HAT",e[e.BOB_XIII_HAT=49]="BOB_XIII_HAT",e[e.PUMPKIN=57]="PUMPKIN",e[e.BUMMLE_HAT=8]="BUMMLE_HAT",e[e.STRAW_HAT=2]="STRAW_HAT",e[e.WINTER_CAP=15]="WINTER_CAP",e[e.COWBOY_HAT=5]="COWBOY_HAT",e[e.RANGER_HAT=4]="RANGER_HAT",e[e.EXPLORER_HAT=18]="EXPLORER_HAT",e[e.FLIPPER_HAT=31]="FLIPPER_HAT",e[e.MARKSMAN_CAP=1]="MARKSMAN_CAP",e[e.BUSH_GEAR=10]="BUSH_GEAR",e[e.HALO=48]="HALO",e[e.SOLDIER_HELMET=6]="SOLDIER_HELMET",e[e.ANTI_VENOM_GEAR=23]="ANTI_VENOM_GEAR",e[e.MEDIC_GEAR=13]="MEDIC_GEAR",e[e.MINERS_HELMET=9]="MINERS_HELMET",e[e.MUSKETEER_HAT=32]="MUSKETEER_HAT",e[e.BULL_HELMET=7]="BULL_HELMET",e[e.EMP_HELMET=22]="EMP_HELMET",e[e.BOOSTER_HAT=12]="BOOSTER_HAT",e[e.BARBARIAN_ARMOR=26]="BARBARIAN_ARMOR",e[e.PLAGUE_MASK=21]="PLAGUE_MASK",e[e.BULL_MASK=46]="BULL_MASK",e[e.WINDMILL_HAT=14]="WINDMILL_HAT",e[e.SPIKE_GEAR=11]="SPIKE_GEAR",e[e.TURRET_GEAR=53]="TURRET_GEAR",e[e.SAMURAI_ARMOR=20]="SAMURAI_ARMOR",e[e.DARK_KNIGHT=58]="DARK_KNIGHT",e[e.SCAVENGER_GEAR=27]="SCAVENGER_GEAR",e[e.TANK_GEAR=40]="TANK_GEAR",e[e.THIEF_GEAR=40]="THIEF_GEAR",e[e.BLOODTHIRSTER=55]="BLOODTHIRSTER",e[e.Assassin_GEAR=56]="Assassin_GEAR",e))(br||{});const Ut=[{id:45,name:"Shame!",dontSell:!0,price:0,scale:120,desc:"hacks are for losers"},{id:51,name:"Moo Cap",price:0,scale:120,desc:"coolest mooer around"},{id:50,name:"Apple Cap",price:0,scale:120,desc:"apple farms remembers"},{id:28,name:"Moo Head",price:0,scale:120,desc:"no effect"},{id:29,name:"Pig Head",price:0,scale:120,desc:"no effect"},{id:30,name:"Fluff Head",price:0,scale:120,desc:"no effect"},{id:36,name:"Pandou Head",price:0,scale:120,desc:"no effect"},{id:37,name:"Bear Head",price:0,scale:120,desc:"no effect"},{id:38,name:"Monkey Head",price:0,scale:120,desc:"no effect"},{id:44,name:"Polar Head",price:0,scale:120,desc:"no effect"},{id:35,name:"Fez Hat",price:0,scale:120,desc:"no effect"},{id:42,name:"Enigma Hat",price:0,scale:120,desc:"join the enigma army"},{id:43,name:"Blitz Hat",price:0,scale:120,desc:"hey everybody i'm blitz"},{id:49,name:"Bob XIII Hat",price:0,scale:120,desc:"like and subscribe"},{id:57,name:"Pumpkin",price:50,scale:120,desc:"Spooooky"},{id:8,name:"Bummle Hat",price:100,scale:120,desc:"no effect"},{id:2,name:"Straw Hat",price:500,scale:120,desc:"no effect"},{id:15,name:"Winter Cap",price:600,scale:120,desc:"allows you to move at normal speed in snow",coldM:1},{id:5,name:"Cowboy Hat",price:1e3,scale:120,desc:"no effect"},{id:4,name:"Ranger Hat",price:2e3,scale:120,desc:"no effect"},{id:18,name:"Explorer Hat",price:2e3,scale:120,desc:"no effect"},{id:31,name:"Flipper Hat",price:2500,scale:120,desc:"have more control while in water",watrImm:!0},{id:1,name:"Marksman Cap",price:3e3,scale:120,desc:"increases arrow speed and range",aMlt:1.3},{id:10,name:"Bush Gear",price:3e3,scale:160,desc:"allows you to disguise yourself as a bush"},{id:48,name:"Halo",price:3e3,scale:120,desc:"no effect"},{id:6,name:"Soldier Helmet",price:4e3,scale:120,desc:"reduces damage taken but slows movement",spdMult:.94,dmgMult:.75},{id:23,name:"Anti Venom Gear",price:4e3,scale:120,desc:"makes you immune to poison",poisonRes:1},{id:13,name:"Medic Gear",price:5e3,scale:110,desc:"slowly regenerates health over time",healthRegen:3},{id:9,name:"Miners Helmet",price:5e3,scale:120,desc:"earn 1 extra gold per resource",extraGold:1},{id:32,name:"Musketeer Hat",price:5e3,scale:120,desc:"reduces cost of projectiles",projCost:.5},{id:7,name:"Bull Helmet",price:6e3,scale:120,desc:"increases damage done but drains health",healthRegen:-5,dmgMultO:1.5,spdMult:.96},{id:22,name:"Emp Helmet",price:6e3,scale:120,desc:"turrets won't attack but you move slower",antiTurret:1,spdMult:.7},{id:12,name:"Booster Hat",price:6e3,scale:120,desc:"increases your movement speed",spdMult:1.16},{id:26,name:"Barbarian Armor",price:8e3,scale:120,desc:"knocks back enemies that attack you",dmgK:.6},{id:21,name:"Plague Mask",price:1e4,scale:120,desc:"melee attacks deal poison damage",poisonDmg:5,poisonTime:6},{id:46,name:"Bull Mask",price:1e4,scale:120,desc:"bulls won't target you unless you attack them",bullRepel:1},{id:14,name:"Windmill Hat",topSprite:!0,price:1e4,scale:120,desc:"generates points while worn",pps:1.5},{id:11,name:"Spike Gear",topSprite:!0,price:1e4,scale:120,desc:"deal damage to players that damage you",dmg:.45},{id:53,name:"Turret Gear",topSprite:!0,price:1e4,scale:120,desc:"you become a walking turret",turret:{proj:1,range:700,rate:2500},spdMult:.7},{id:20,name:"Samurai Armor",price:12e3,scale:120,desc:"increased attack speed and fire rate",atkSpd:.78},{id:58,name:"Dark Knight",price:12e3,scale:120,desc:"restores health when you deal damage",healD:.4},{id:27,name:"Scavenger Gear",price:15e3,scale:120,desc:"earn double points for each kill",kScrM:2},{id:40,name:"Tank Gear",price:15e3,scale:120,desc:"increased damage to buildings but slower movement",spdMult:.3,bDmg:3.3},{id:52,name:"Thief Gear",price:15e3,scale:120,desc:"steal half of a players gold when you kill them",goldSteal:.5},{id:55,name:"Bloodthirster",price:2e4,scale:120,desc:"Restore Health when dealing damage. And increased damage",healD:.25,dmgMultO:1.2},{id:56,name:"Assassin Gear",price:2e4,scale:120,desc:"Go invisible when not moving. Can't eat. Increased speed",noEat:!0,spdMult:1.1,invisTimer:1e3}];var Tr=(e=>(e[e.SNOWBALL=12]="SNOWBALL",e[e.TREE_CAPE=9]="TREE_CAPE",e[e.STONE_CAPE=10]="STONE_CAPE",e[e.COOKIE_CAPE=3]="COOKIE_CAPE",e[e.COW_CAPE=8]="COW_CAPE",e[e.MONKEY_TAIL=11]="MONKEY_TAIL",e[e.APPLE_BASKET=17]="APPLE_BASKET",e[e.WINTER_CAPE=6]="WINTER_CAPE",e[e.SKULL_CAPE=4]="SKULL_CAPE",e[e.DASH_CAPE=5]="DASH_CAPE",e[e.DRAGON_CAPE=2]="DRAGON_CAPE",e[e.SUPER_CAPE=1]="SUPER_CAPE",e[e.TROLL_CAPE=7]="TROLL_CAPE",e[e.THORNS=14]="THORNS",e[e.BLOCKADES=15]="BLOCKADES",e[e.DEVILS_TAIL=20]="DEVILS_TAIL",e[e.SAWBLADE=16]="SAWBLADE",e[e.ANGEL_WINGS=13]="ANGEL_WINGS",e[e.SHADOW_WINGS=19]="SHADOW_WINGS",e[e.BLOOD_WINGS=18]="BLOOD_WINGS",e[e.CORRUPT_X_WINGS=21]="CORRUPT_X_WINGS",e))(Tr||{});const Mt=[{id:12,name:"Snowball",price:1e3,scale:105,xOff:18,desc:"no effect"},{id:9,name:"Tree Cape",price:1e3,scale:90,desc:"no effect"},{id:10,name:"Stone Cape",price:1e3,scale:90,desc:"no effect"},{id:3,name:"Cookie Cape",price:1500,scale:90,desc:"no effect"},{id:8,name:"Cow Cape",price:2e3,scale:90,desc:"no effect"},{id:11,name:"Monkey Tail",price:2e3,scale:97,xOff:25,desc:"Super speed but reduced damage",spdMult:1.35,dmgMultO:.2},{id:17,name:"Apple Basket",price:3e3,scale:80,xOff:12,desc:"slowly regenerates health over time",healthRegen:1},{id:6,name:"Winter Cape",price:3e3,scale:90,desc:"no effect"},{id:4,name:"Skull Cape",price:4e3,scale:90,desc:"no effect"},{id:5,name:"Dash Cape",price:5e3,scale:90,desc:"no effect"},{id:2,name:"Dragon Cape",price:6e3,scale:90,desc:"no effect"},{id:1,name:"Super Cape",price:8e3,scale:90,desc:"no effect"},{id:7,name:"Troll Cape",price:8e3,scale:90,desc:"no effect"},{id:14,name:"Thorns",price:1e4,scale:115,xOff:20,desc:"no effect"},{id:15,name:"Blockades",price:1e4,scale:95,xOff:15,desc:"no effect"},{id:20,name:"Devils Tail",price:1e4,scale:95,xOff:20,desc:"no effect"},{id:16,name:"Sawblade",price:12e3,scale:90,spin:!0,xOff:0,desc:"deal damage to players that damage you",dmg:.15},{id:13,name:"Angel Wings",price:15e3,scale:138,xOff:22,desc:"slowly regenerates health over time",healthRegen:3},{id:19,name:"Shadow Wings",price:15e3,scale:138,xOff:22,desc:"increased movement speed",spdMult:1.1},{id:18,name:"Blood Wings",price:2e4,scale:178,xOff:26,desc:"restores health when you deal damage",healD:.2},{id:21,name:"Corrupt X Wings",price:2e4,scale:178,xOff:26,desc:"deal damage to players that damage you",dmg:.25}];class Nt{constructor(r,t,i,n,a,s,E,R){this.x=r,this.y=t,this.dir=i,this.range=n,this.speed=a,this.projectileType=s,this.layer=E,this.sid=R}getAsPos(){return new Se(this.x,this.y)}}var rr={},tr={},gr={},Ne={},K={},Dt=ir(typeof Buffer!="undefined"&&Buffer)||ir(fe.Buffer)||ir(typeof window!="undefined"&&window.Buffer)||fe.Buffer;function ir(e){return e&&e.isBuffer&&e}var Ft={}.toString,nr=Array.isArray||function(e){return Ft.call(e)=="[object Array]"},Or={exports:{}},xe=K,De=Or.exports=Pr(0);De.alloc=Pr,De.concat=xe.concat,De.from=kt;function Pr(e){return new Array(e)}function kt(e){if(!xe.isBuffer(e)&&xe.isView(e))e=xe.Uint8Array.from(e);else if(xe.isArrayBuffer(e))e=new Uint8Array(e);else{if(typeof e=="string")return xe.from.call(De,e);if(typeof e=="number")throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(e)}var Lr={exports:{}},q=K,Ae=q.global,Fe=Lr.exports=q.hasBuffer?Sr(0):[];Fe.alloc=q.hasBuffer&&Ae.alloc||Sr,Fe.concat=q.concat,Fe.from=Gt;function Sr(e){return new Ae(e)}function Gt(e){if(!q.isBuffer(e)&&q.isView(e))e=q.Uint8Array.from(e);else if(q.isArrayBuffer(e))e=new Uint8Array(e);else{if(typeof e=="string")return q.from.call(Fe,e);if(typeof e=="number")throw new TypeError('"value" argument must not be a number')}return Ae.from&&Ae.from.length!==1?Ae.from(e):new Ae(e)}var Ur={exports:{}},ke=K,Ge=Ur.exports=ke.hasArrayBuffer?Mr(0):[];Ge.alloc=Mr,Ge.concat=ke.concat,Ge.from=Ct;function Mr(e){return new Uint8Array(e)}function Ct(e){if(ke.isView(e)){var r=e.byteOffset,t=e.byteLength;e=e.buffer,e.byteLength!==t&&(e.slice?e=e.slice(r,r+t):(e=new Uint8Array(e),e.byteLength!==t&&(e=Array.prototype.slice.call(e,r,r+t))))}else{if(typeof e=="string")return ke.from.call(Ge,e);if(typeof e=="number")throw new TypeError('"value" argument must not be a number')}return new Uint8Array(e)}var oe={},Ce={};Ce.copy=$t,Ce.toString=Wt,Ce.write=Kt;function Kt(e,r){for(var t=this,i=r||(r|=0),n=e.length,a=0,s=0;s<n;)a=e.charCodeAt(s++),a<128?t[i++]=a:a<2048?(t[i++]=192|a>>>6,t[i++]=128|a&63):a<55296||a>57343?(t[i++]=224|a>>>12,t[i++]=128|a>>>6&63,t[i++]=128|a&63):(a=(a-55296<<10|e.charCodeAt(s++)-56320)+65536,t[i++]=240|a>>>18,t[i++]=128|a>>>12&63,t[i++]=128|a>>>6&63,t[i++]=128|a&63);return i-r}function Wt(e,r,t){var i=this,n=r|0;t||(t=i.length);for(var a="",s=0;n<t;){if(s=i[n++],s<128){a+=String.fromCharCode(s);continue}(s&224)===192?s=(s&31)<<6|i[n++]&63:(s&240)===224?s=(s&15)<<12|(i[n++]&63)<<6|i[n++]&63:(s&248)===240&&(s=(s&7)<<18|(i[n++]&63)<<12|(i[n++]&63)<<6|i[n++]&63),s>=65536?(s-=65536,a+=String.fromCharCode((s>>>10)+55296,(s&1023)+56320)):a+=String.fromCharCode(s)}return a}function $t(e,r,t,i){var n;t||(t=0),!i&&i!==0&&(i=this.length),r||(r=0);var a=i-t;if(e===this&&t<r&&r<i)for(n=a-1;n>=0;n--)e[n+r]=this[n+t];else for(n=0;n<a;n++)e[n+r]=this[n+t];return a}var ar=Ce;oe.copy=kr,oe.slice=Gr,oe.toString=jt,oe.write=Ht("write");var ie=K,Nr=ie.global,Dr=ie.hasBuffer&&"TYPED_ARRAY_SUPPORT"in Nr,Fr=Dr&&!Nr.TYPED_ARRAY_SUPPORT;function kr(e,r,t,i){var n=ie.isBuffer(this),a=ie.isBuffer(e);if(n&&a)return this.copy(e,r,t,i);if(!Fr&&!n&&!a&&ie.isView(this)&&ie.isView(e)){var s=t||i!=null?Gr.call(this,t,i):this;return e.set(s,r),s.length}else return ar.copy.call(this,e,r,t,i)}function Gr(e,r){var t=this.slice||!Fr&&this.subarray;if(t)return t.call(this,e,r);var i=ie.alloc.call(this,r-e);return kr.call(this,i,0,e,r),i}function jt(e,r,t){var i=!Dr&&ie.isBuffer(this)?this.toString:ar.toString;return i.apply(this,arguments)}function Ht(e){return r;function r(){var t=this[e]||ar[e];return t.apply(this,arguments)}}(function(e){var r=e.global=Dt,t=e.hasBuffer=r&&!!r.isBuffer,i=e.hasArrayBuffer=typeof ArrayBuffer!="undefined",n=e.isArray=nr;e.isArrayBuffer=i?D:G;var a=e.isBuffer=t?r.isBuffer:G,s=e.isView=i?ArrayBuffer.isView||X("ArrayBuffer","buffer"):G;e.alloc=y,e.concat=x,e.from=l;var E=e.Array=Or.exports,R=e.Buffer=Lr.exports,L=e.Uint8Array=Ur.exports,_=e.prototype=oe;function l(u){return typeof u=="string"?k.call(this,u):I(this).from(u)}function y(u){return I(this).alloc(u)}function x(u,p){p||(p=0,Array.prototype.forEach.call(u,m));var O=this!==e&&this||u[0],B=y.call(O,p),h=0;return Array.prototype.forEach.call(u,f),B;function m(o){p+=o.length}function f(o){h+=_.copy.call(o,B,h)}}var d=X("ArrayBuffer");function D(u){return u instanceof ArrayBuffer||d(u)}function k(u){var p=u.length*3,O=y.call(this,p),B=_.write.call(O,u);return p!==B&&(O=_.slice.call(O,0,B)),O}function I(u){return a(u)?R:s(u)?L:n(u)?E:t?R:i?L:E}function G(){return!1}function X(u,p){return u="[object "+u+"]",function(O){return O!=null&&{}.toString.call(p?O[p]:O)===u}}})(K),Ne.ExtBuffer=sr;var Yt=K;function sr(e,r){if(!(this instanceof sr))return new sr(e,r);this.buffer=Yt.from(e),this.type=r}var Cr={};Cr.setExtPackers=Xt;var Ke=K,Vt=Ke.global,Y=Ke.Uint8Array.from,fr,It={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function Xt(e){e.addExtPacker(14,Error,[ce,j]),e.addExtPacker(1,EvalError,[ce,j]),e.addExtPacker(2,RangeError,[ce,j]),e.addExtPacker(3,ReferenceError,[ce,j]),e.addExtPacker(4,SyntaxError,[ce,j]),e.addExtPacker(5,TypeError,[ce,j]),e.addExtPacker(6,URIError,[ce,j]),e.addExtPacker(10,RegExp,[zt,j]),e.addExtPacker(11,Boolean,[or,j]),e.addExtPacker(12,String,[or,j]),e.addExtPacker(13,Date,[Number,j]),e.addExtPacker(15,Number,[or,j]),typeof Uint8Array!="undefined"&&(e.addExtPacker(17,Int8Array,Y),e.addExtPacker(18,Uint8Array,Y),e.addExtPacker(19,Int16Array,Y),e.addExtPacker(20,Uint16Array,Y),e.addExtPacker(21,Int32Array,Y),e.addExtPacker(22,Uint32Array,Y),e.addExtPacker(23,Float32Array,Y),typeof Float64Array!="undefined"&&e.addExtPacker(24,Float64Array,Y),typeof Uint8ClampedArray!="undefined"&&e.addExtPacker(25,Uint8ClampedArray,Y),e.addExtPacker(26,ArrayBuffer,Y),e.addExtPacker(29,DataView,Y)),Ke.hasBuffer&&e.addExtPacker(27,Vt,Ke.from)}function j(e){return fr||(fr=rr.encode),fr(e)}function or(e){return e.valueOf()}function zt(e){e=RegExp.prototype.toString.call(e).split("/"),e.shift();var r=[e.pop()];return r.unshift(e.join("/")),r}function ce(e){var r={};for(var t in It)r[t]=e[t];return r}var Kr={},We={};(function(e){(function(r){var t="undefined",i=t!==typeof Buffer&&Buffer,n=t!==typeof Uint8Array&&Uint8Array,a=t!==typeof ArrayBuffer&&ArrayBuffer,s=[0,0,0,0,0,0,0,0],E=Array.isArray||O,R=4294967296,L=16777216,_;l("Uint64BE",!0,!0),l("Int64BE",!0,!1),l("Uint64LE",!1,!0),l("Int64LE",!1,!1);function l(B,h,m){var f=h?0:4,o=h?4:0,c=h?0:3,T=h?1:2,S=h?2:1,$=h?3:0,Z=h?G:u,be=h?X:p,C=se.prototype,ae="is"+B,ze="_"+ae;return C.buffer=void 0,C.offset=0,C[ze]=!0,C.toNumber=Bt,C.toString=On,C.toJSON=Bt,C.toArray=y,i&&(C.toBuffer=x),n&&(C.toArrayBuffer=d),se[ae]=vr,r[B]=se,se;function se(w,A,v,b){return this instanceof se?Tn(this,w,A,v,b):new se(w,A,v,b)}function vr(w){return!!(w&&w[ze])}function Tn(w,A,v,b,N){if(n&&a&&(A instanceof a&&(A=new n(A)),b instanceof a&&(b=new n(b))),!A&&!v&&!b&&!_){w.buffer=I(s,0);return}if(!D(A,v)){var ee=_||Array;N=v,b=A,v=0,A=new ee(8)}w.buffer=A,w.offset=v|=0,t!==typeof b&&(typeof b=="string"?gn(A,v,b,N||10):D(b,N)?k(A,v,b,N):typeof N=="number"?(Je(A,v+f,b),Je(A,v+o,N)):b>0?Z(A,v,b):b<0?be(A,v,b):k(A,v,s,0))}function gn(w,A,v,b){var N=0,ee=v.length,re=0,z=0;v[0]==="-"&&N++;for(var Pn=N;N<ee;){var yt=parseInt(v[N++],b);if(!(yt>=0))break;z=z*b+yt,re=re*b+Math.floor(z/R),z%=R}Pn&&(re=~re,z?z=R-z:re++),Je(w,A+f,re),Je(w,A+o,z)}function Bt(){var w=this.buffer,A=this.offset,v=Ze(w,A+f),b=Ze(w,A+o);return m||(v|=0),v?v*R+b:b}function On(w){var A=this.buffer,v=this.offset,b=Ze(A,v+f),N=Ze(A,v+o),ee="",re=!m&&b&2147483648;for(re&&(b=~b,N=R-N),w=w||10;;){var z=b%w*R+N;if(b=Math.floor(b/w),N=Math.floor(z/w),ee=(z%w).toString(w)+ee,!b&&!N)break}return re&&(ee="-"+ee),ee}function Je(w,A,v){w[A+$]=v&255,v=v>>8,w[A+S]=v&255,v=v>>8,w[A+T]=v&255,v=v>>8,w[A+c]=v&255}function Ze(w,A){return w[A+c]*L+(w[A+T]<<16)+(w[A+S]<<8)+w[A+$]}}function y(B){var h=this.buffer,m=this.offset;return _=null,B!==!1&&m===0&&h.length===8&&E(h)?h:I(h,m)}function x(B){var h=this.buffer,m=this.offset;if(_=i,B!==!1&&m===0&&h.length===8&&Buffer.isBuffer(h))return h;var f=new i(8);return k(f,0,h,m),f}function d(B){var h=this.buffer,m=this.offset,f=h.buffer;if(_=n,B!==!1&&m===0&&f instanceof a&&f.byteLength===8)return f;var o=new n(8);return k(o,0,h,m),o.buffer}function D(B,h){var m=B&&B.length;return h|=0,m&&h+8<=m&&typeof B[h]!="string"}function k(B,h,m,f){h|=0,f|=0;for(var o=0;o<8;o++)B[h++]=m[f++]&255}function I(B,h){return Array.prototype.slice.call(B,h,h+8)}function G(B,h,m){for(var f=h+8;f>h;)B[--f]=m&255,m/=256}function X(B,h,m){var f=h+8;for(m++;f>h;)B[--f]=-m&255^255,m/=256}function u(B,h,m){for(var f=h+8;h<f;)B[h++]=m&255,m/=256}function p(B,h,m){var f=h+8;for(m++;h<f;)B[h++]=-m&255^255,m/=256}function O(B){return!!B&&Object.prototype.toString.call(B)=="[object Array]"}})(typeof e.nodeName!="string"?e:fe||{})})(We);var Wr={},$e={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */$e.read=function(e,r,t,i,n){var a,s,E=n*8-i-1,R=(1<<E)-1,L=R>>1,_=-7,l=t?n-1:0,y=t?-1:1,x=e[r+l];for(l+=y,a=x&(1<<-_)-1,x>>=-_,_+=E;_>0;a=a*256+e[r+l],l+=y,_-=8);for(s=a&(1<<-_)-1,a>>=-_,_+=i;_>0;s=s*256+e[r+l],l+=y,_-=8);if(a===0)a=1-L;else{if(a===R)return s?NaN:(x?-1:1)*(1/0);s=s+Math.pow(2,i),a=a-L}return(x?-1:1)*s*Math.pow(2,a-i)},$e.write=function(e,r,t,i,n,a){var s,E,R,L=a*8-n-1,_=(1<<L)-1,l=_>>1,y=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=i?0:a-1,d=i?1:-1,D=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(E=isNaN(r)?1:0,s=_):(s=Math.floor(Math.log(r)/Math.LN2),r*(R=Math.pow(2,-s))<1&&(s--,R*=2),s+l>=1?r+=y/R:r+=y*Math.pow(2,1-l),r*R>=2&&(s++,R/=2),s+l>=_?(E=0,s=_):s+l>=1?(E=(r*R-1)*Math.pow(2,n),s=s+l):(E=r*Math.pow(2,l-1)*Math.pow(2,n),s=0));n>=8;e[t+x]=E&255,x+=d,E/=256,n-=8);for(s=s<<n|E,L+=n;L>0;e[t+x]=s&255,x+=d,s/=256,L-=8);e[t+x-d]|=D*128};for(var cr={},Jt=cr.uint8=new Array(256),je=0;je<=255;je++)Jt[je]=Zt(je);function Zt(e){return function(r){var t=r.reserve(1);r.buffer[t]=e}}var $r=$e,jr=We,qt=jr.Uint64BE,Qt=jr.Int64BE,Hr=cr.uint8,He=K,P=He.global,ei=He.hasBuffer&&"TYPED_ARRAY_SUPPORT"in P,ri=ei&&!P.TYPED_ARRAY_SUPPORT,Yr=He.hasBuffer&&P.prototype||{};Wr.getWriteToken=ti;function ti(e){return e&&e.uint8array?ii():ri||He.hasBuffer&&e&&e.safe?ni():Vr()}function ii(){var e=Vr();return e[202]=g(202,4,zr),e[203]=g(203,8,Jr),e}function Vr(){var e=Hr.slice();return e[196]=Oe(196),e[197]=ue(197),e[198]=he(198),e[199]=Oe(199),e[200]=ue(200),e[201]=he(201),e[202]=g(202,4,Yr.writeFloatBE||zr,!0),e[203]=g(203,8,Yr.writeDoubleBE||Jr,!0),e[204]=Oe(204),e[205]=ue(205),e[206]=he(206),e[207]=g(207,8,Ir),e[208]=Oe(208),e[209]=ue(209),e[210]=he(210),e[211]=g(211,8,Xr),e[217]=Oe(217),e[218]=ue(218),e[219]=he(219),e[220]=ue(220),e[221]=he(221),e[222]=ue(222),e[223]=he(223),e}function ni(){var e=Hr.slice();return e[196]=g(196,1,P.prototype.writeUInt8),e[197]=g(197,2,P.prototype.writeUInt16BE),e[198]=g(198,4,P.prototype.writeUInt32BE),e[199]=g(199,1,P.prototype.writeUInt8),e[200]=g(200,2,P.prototype.writeUInt16BE),e[201]=g(201,4,P.prototype.writeUInt32BE),e[202]=g(202,4,P.prototype.writeFloatBE),e[203]=g(203,8,P.prototype.writeDoubleBE),e[204]=g(204,1,P.prototype.writeUInt8),e[205]=g(205,2,P.prototype.writeUInt16BE),e[206]=g(206,4,P.prototype.writeUInt32BE),e[207]=g(207,8,Ir),e[208]=g(208,1,P.prototype.writeInt8),e[209]=g(209,2,P.prototype.writeInt16BE),e[210]=g(210,4,P.prototype.writeInt32BE),e[211]=g(211,8,Xr),e[217]=g(217,1,P.prototype.writeUInt8),e[218]=g(218,2,P.prototype.writeUInt16BE),e[219]=g(219,4,P.prototype.writeUInt32BE),e[220]=g(220,2,P.prototype.writeUInt16BE),e[221]=g(221,4,P.prototype.writeUInt32BE),e[222]=g(222,2,P.prototype.writeUInt16BE),e[223]=g(223,4,P.prototype.writeUInt32BE),e}function Oe(e){return function(r,t){var i=r.reserve(2),n=r.buffer;n[i++]=e,n[i]=t}}function ue(e){return function(r,t){var i=r.reserve(3),n=r.buffer;n[i++]=e,n[i++]=t>>>8,n[i]=t}}function he(e){return function(r,t){var i=r.reserve(5),n=r.buffer;n[i++]=e,n[i++]=t>>>24,n[i++]=t>>>16,n[i++]=t>>>8,n[i]=t}}function g(e,r,t,i){return function(n,a){var s=n.reserve(r+1);n.buffer[s++]=e,t.call(n.buffer,a,s,i)}}function Ir(e,r){new qt(this,r,e)}function Xr(e,r){new Qt(this,r,e)}function zr(e,r){$r.write(this,e,r,!1,23,4)}function Jr(e,r){$r.write(this,e,r,!1,52,8)}var ai=nr,Zr=We,si=Zr.Uint64BE,fi=Zr.Int64BE,qr=K,Qr=oe,oi=Wr,ci=cr.uint8,ui=Ne.ExtBuffer,hi=typeof Uint8Array!="undefined",li=typeof Map!="undefined",ve=[];ve[1]=212,ve[2]=213,ve[4]=214,ve[8]=215,ve[16]=216,Kr.getWriteType=Ei;function Ei(e){var r=oi.getWriteToken(e),t=e&&e.useraw,i=hi&&e&&e.binarraybuffer,n=i?qr.isArrayBuffer:qr.isBuffer,a=i?p:u,s=li&&e&&e.usemap,E=s?h:B,R={boolean:L,function:G,number:_,object:t?I:k,string:D(t?d:x),symbol:G,undefined:G};return R;function L(f,o){var c=o?195:194;r[c](f,o)}function _(f,o){var c=o|0,T;if(o!==c){T=203,r[T](f,o);return}else-32<=c&&c<=127?T=c&255:0<=c?T=c<=255?204:c<=65535?205:206:T=-128<=c?208:-32768<=c?209:210;r[T](f,c)}function l(f,o){var c=207;r[c](f,o.toArray())}function y(f,o){var c=211;r[c](f,o.toArray())}function x(f){return f<32?1:f<=255?2:f<=65535?3:5}function d(f){return f<32?1:f<=65535?3:5}function D(f){return o;function o(c,T){var S=T.length,$=5+S*3;c.offset=c.reserve($);var Z=c.buffer,be=f(S),C=c.offset+be;S=Qr.write.call(Z,T,C);var ae=f(S);if(be!==ae){var ze=C+ae-be,se=C+S;Qr.copy.call(Z,Z,ze,C,se)}var vr=ae===1?160+S:ae<=3?215+ae:219;r[vr](c,S),c.offset+=S}}function k(f,o){if(o===null)return G(f,o);if(n(o))return a(f,o);if(ai(o))return X(f,o);if(si.isUint64BE(o))return l(f,o);if(fi.isInt64BE(o))return y(f,o);var c=f.codec.getExtPacker(o);if(c&&(o=c(o)),o instanceof ui)return O(f,o);E(f,o)}function I(f,o){if(n(o))return m(f,o);k(f,o)}function G(f,o){var c=192;r[c](f,o)}function X(f,o){var c=o.length,T=c<16?144+c:c<=65535?220:221;r[T](f,c);for(var S=f.codec.encode,$=0;$<c;$++)S(f,o[$])}function u(f,o){var c=o.length,T=c<255?196:c<=65535?197:198;r[T](f,c),f.send(o)}function p(f,o){u(f,new Uint8Array(o))}function O(f,o){var c=o.buffer,T=c.length,S=ve[T]||(T<255?199:T<=65535?200:201);r[S](f,T),ci[o.type](f),f.send(c)}function B(f,o){var c=Object.keys(o),T=c.length,S=T<16?128+T:T<=65535?222:223;r[S](f,T);var $=f.codec.encode;c.forEach(function(Z){$(f,Z),$(f,o[Z])})}function h(f,o){if(!(o instanceof Map))return B(f,o);var c=o.size,T=c<16?128+c:c<=65535?222:223;r[T](f,c);var S=f.codec.encode;o.forEach(function($,Z,be){S(f,Z),S(f,$)})}function m(f,o){var c=o.length,T=c<32?160+c:c<=65535?218:219;r[T](f,c),f.send(o)}}var le={},pi=nr;le.createCodec=et,le.install=xi,le.filter=_i;var di=K;function _e(e){if(!(this instanceof _e))return new _e(e);this.options=e,this.init()}_e.prototype.init=function(){var e=this.options;return e&&e.uint8array&&(this.bufferish=di.Uint8Array),this};function xi(e){for(var r in e)_e.prototype[r]=Ai(_e.prototype[r],e[r])}function Ai(e,r){return e&&r?t:e||r;function t(){return e.apply(this,arguments),r.apply(this,arguments)}}function vi(e){return e=e.slice(),function(t){return e.reduce(r,t)};function r(t,i){return i(t)}}function _i(e){return pi(e)?vi(e):e}function et(e){return new _e(e)}le.preset=et({preset:!0});var Bi=Ne.ExtBuffer,yi=Cr,Ri=Kr,ur=le;ur.install({addExtPacker:wi,getExtPacker:bi,init:rt}),gr.preset=rt.call(ur.preset);function mi(e){var r=Ri.getWriteType(e);return t;function t(i,n){var a=r[typeof n];if(!a)throw new Error('Unsupported type "'+typeof n+'": '+n);a(i,n)}}function rt(){var e=this.options;return this.encode=mi(e),e&&e.preset&&yi.setExtPackers(this),this}function wi(e,r,t){t=ur.filter(t);var i=r.name;if(i&&i!=="Object"){var n=this.extPackers||(this.extPackers={});n[i]=s}else{var a=this.extEncoderList||(this.extEncoderList=[]);a.unshift([r,s])}function s(E){return t&&(E=t(E)),new Bi(E,e)}}function bi(e){var r=this.extPackers||(this.extPackers={}),t=e.constructor,i=t&&t.name&&r[t.name];if(i)return i;for(var n=this.extEncoderList||(this.extEncoderList=[]),a=n.length,s=0;s<a;s++){var E=n[s];if(t===E[0])return E[1]}}var Ye={};Ye.FlexDecoder=Be,Ye.FlexEncoder=ye;var Pe=K,Ti=2048,gi=65536,tt="BUFFER_SHORTAGE";function Be(){if(!(this instanceof Be))return new Be}function ye(){if(!(this instanceof ye))return new ye}Be.mixin=at(Oi()),Be.mixin(Be.prototype),ye.mixin=at(Pi()),ye.mixin(ye.prototype);function Oi(){return{bufferish:Pe,write:e,fetch:Si,flush:r,push:nt,pull:Ui,read:it,reserve:t,offset:0};function e(i){var n=this.offset?Pe.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=n?i?this.bufferish.concat([n,i]):n:i,this.offset=0}function r(){for(;this.offset<this.buffer.length;){var i=this.offset,n;try{n=this.fetch()}catch(a){if(a&&a.message!=tt)throw a;this.offset=i;break}this.push(n)}}function t(i){var n=this.offset,a=n+i;if(a>this.buffer.length)throw new Error(tt);return this.offset=a,n}}function Pi(){return{bufferish:Pe,write:Li,fetch:e,flush:r,push:nt,pull:t,read:it,reserve:i,send:n,maxBufferSize:gi,minBufferSize:Ti,offset:0,start:0};function e(){var a=this.start;if(a<this.offset){var s=this.start=this.offset;return Pe.prototype.slice.call(this.buffer,a,s)}}function r(){for(;this.start<this.offset;){var a=this.fetch();a&&this.push(a)}}function t(){var a=this.buffers||(this.buffers=[]),s=a.length>1?this.bufferish.concat(a):a[0];return a.length=0,s}function i(a){var s=a|0;if(this.buffer){var E=this.buffer.length,R=this.offset|0,L=R+s;if(L<E)return this.offset=L,R;this.flush(),a=Math.max(a,Math.min(E*2,this.maxBufferSize))}return a=Math.max(a,this.minBufferSize),this.buffer=this.bufferish.alloc(a),this.start=0,this.offset=s,0}function n(a){var s=a.length;if(s>this.minBufferSize)this.flush(),this.push(a);else{var E=this.reserve(s);Pe.prototype.copy.call(a,this.buffer,E)}}}function Li(){throw new Error("method not implemented: write()")}function Si(){throw new Error("method not implemented: fetch()")}function it(){var e=this.buffers&&this.buffers.length;return e?(this.flush(),this.pull()):this.fetch()}function nt(e){var r=this.buffers||(this.buffers=[]);r.push(e)}function Ui(){var e=this.buffers||(this.buffers=[]);return e.shift()}function at(e){return r;function r(t){for(var i in e)t[i]=e[i];return t}}tr.EncodeBuffer=Re;var Mi=gr.preset,Ni=Ye.FlexEncoder;Ni.mixin(Re.prototype);function Re(e){if(!(this instanceof Re))return new Re(e);if(e&&(this.options=e,e.codec)){var r=this.codec=e.codec;r.bufferish&&(this.bufferish=r.bufferish)}}Re.prototype.codec=Mi,Re.prototype.write=function(e){this.codec.encode(this,e)},rr.encode=Fi;var Di=tr.EncodeBuffer;function Fi(e,r){var t=new Di(r);return t.write(e),t.read()}var hr={},lr={},st={},ft={};ft.setExtUnpackers=Ci;var ot=K,ki=ot.global,Er,Gi={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function Ci(e){e.addExtUnpacker(14,[H,Ee(Error)]),e.addExtUnpacker(1,[H,Ee(EvalError)]),e.addExtUnpacker(2,[H,Ee(RangeError)]),e.addExtUnpacker(3,[H,Ee(ReferenceError)]),e.addExtUnpacker(4,[H,Ee(SyntaxError)]),e.addExtUnpacker(5,[H,Ee(TypeError)]),e.addExtUnpacker(6,[H,Ee(URIError)]),e.addExtUnpacker(10,[H,Ki]),e.addExtUnpacker(11,[H,F(Boolean)]),e.addExtUnpacker(12,[H,F(String)]),e.addExtUnpacker(13,[H,F(Date)]),e.addExtUnpacker(15,[H,F(Number)]),typeof Uint8Array!="undefined"&&(e.addExtUnpacker(17,F(Int8Array)),e.addExtUnpacker(18,F(Uint8Array)),e.addExtUnpacker(19,[ne,F(Int16Array)]),e.addExtUnpacker(20,[ne,F(Uint16Array)]),e.addExtUnpacker(21,[ne,F(Int32Array)]),e.addExtUnpacker(22,[ne,F(Uint32Array)]),e.addExtUnpacker(23,[ne,F(Float32Array)]),typeof Float64Array!="undefined"&&e.addExtUnpacker(24,[ne,F(Float64Array)]),typeof Uint8ClampedArray!="undefined"&&e.addExtUnpacker(25,F(Uint8ClampedArray)),e.addExtUnpacker(26,ne),e.addExtUnpacker(29,[ne,F(DataView)])),ot.hasBuffer&&e.addExtUnpacker(27,F(ki))}function H(e){return Er||(Er=hr.decode),Er(e)}function Ki(e){return RegExp.apply(null,e)}function Ee(e){return function(r){var t=new e;for(var i in Gi)t[i]=r[i];return t}}function F(e){return function(r){return new e(r)}}function ne(e){return new Uint8Array(e).buffer}var Ve={},ct=$e,ut=We,ht=ut.Uint64BE,lt=ut.Int64BE;Ve.getReadFormat=ji,Ve.readUint8=Et;var pr=K,Ie=oe,Wi=typeof Map!="undefined",$i=!0;function ji(e){var r=pr.hasArrayBuffer&&e&&e.binarraybuffer,t=e&&e.int64,i=Wi&&e&&e.usemap,n={map:i?Yi:Hi,array:Vi,str:Ii,bin:r?zi:Xi,ext:Ji,uint8:Et,uint16:qi,uint32:en,uint64:Xe(8,t?an:tn),int8:Zi,int16:Qi,int32:rn,int64:Xe(8,t?sn:nn),float32:Xe(4,fn),float64:Xe(8,on)};return n}function Hi(e,r){var t={},i,n=new Array(r),a=new Array(r),s=e.codec.decode;for(i=0;i<r;i++)n[i]=s(e),a[i]=s(e);for(i=0;i<r;i++)t[n[i]]=a[i];return t}function Yi(e,r){var t=new Map,i,n=new Array(r),a=new Array(r),s=e.codec.decode;for(i=0;i<r;i++)n[i]=s(e),a[i]=s(e);for(i=0;i<r;i++)t.set(n[i],a[i]);return t}function Vi(e,r){for(var t=new Array(r),i=e.codec.decode,n=0;n<r;n++)t[n]=i(e);return t}function Ii(e,r){var t=e.reserve(r),i=t+r;return Ie.toString.call(e.buffer,"utf-8",t,i)}function Xi(e,r){var t=e.reserve(r),i=t+r,n=Ie.slice.call(e.buffer,t,i);return pr.from(n)}function zi(e,r){var t=e.reserve(r),i=t+r,n=Ie.slice.call(e.buffer,t,i);return pr.Uint8Array.from(n).buffer}function Ji(e,r){var t=e.reserve(r+1),i=e.buffer[t++],n=t+r,a=e.codec.getExtUnpacker(i);if(!a)throw new Error("Invalid ext type: "+(i&&"0x"+i.toString(16)));var s=Ie.slice.call(e.buffer,t,n);return a(s)}function Et(e){var r=e.reserve(1);return e.buffer[r]}function Zi(e){var r=e.reserve(1),t=e.buffer[r];return t&128?t-256:t}function qi(e){var r=e.reserve(2),t=e.buffer;return t[r++]<<8|t[r]}function Qi(e){var r=e.reserve(2),t=e.buffer,i=t[r++]<<8|t[r];return i&32768?i-65536:i}function en(e){var r=e.reserve(4),t=e.buffer;return t[r++]*16777216+(t[r++]<<16)+(t[r++]<<8)+t[r]}function rn(e){var r=e.reserve(4),t=e.buffer;return t[r++]<<24|t[r++]<<16|t[r++]<<8|t[r]}function Xe(e,r){return function(t){var i=t.reserve(e);return r.call(t.buffer,i,$i)}}function tn(e){return new ht(this,e).toNumber()}function nn(e){return new lt(this,e).toNumber()}function an(e){return new ht(this,e)}function sn(e){return new lt(this,e)}function fn(e){return ct.read(this,e,!1,23,4)}function on(e){return ct.read(this,e,!1,52,8)}var pt={},cn=Ve;pt.getReadToken=un;function un(e){var r=cn.getReadFormat(e);return e&&e.useraw?hn(r):dt(r)}function dt(e){var r,t=new Array(256);for(r=0;r<=127;r++)t[r]=Le(r);for(r=128;r<=143;r++)t[r]=Q(r-128,e.map);for(r=144;r<=159;r++)t[r]=Q(r-144,e.array);for(r=160;r<=191;r++)t[r]=Q(r-160,e.str);for(t[192]=Le(null),t[193]=null,t[194]=Le(!1),t[195]=Le(!0),t[196]=W(e.uint8,e.bin),t[197]=W(e.uint16,e.bin),t[198]=W(e.uint32,e.bin),t[199]=W(e.uint8,e.ext),t[200]=W(e.uint16,e.ext),t[201]=W(e.uint32,e.ext),t[202]=e.float32,t[203]=e.float64,t[204]=e.uint8,t[205]=e.uint16,t[206]=e.uint32,t[207]=e.uint64,t[208]=e.int8,t[209]=e.int16,t[210]=e.int32,t[211]=e.int64,t[212]=Q(1,e.ext),t[213]=Q(2,e.ext),t[214]=Q(4,e.ext),t[215]=Q(8,e.ext),t[216]=Q(16,e.ext),t[217]=W(e.uint8,e.str),t[218]=W(e.uint16,e.str),t[219]=W(e.uint32,e.str),t[220]=W(e.uint16,e.array),t[221]=W(e.uint32,e.array),t[222]=W(e.uint16,e.map),t[223]=W(e.uint32,e.map),r=224;r<=255;r++)t[r]=Le(r-256);return t}function hn(e){var r,t=dt(e).slice();for(t[217]=t[196],t[218]=t[197],t[219]=t[198],r=160;r<=191;r++)t[r]=Q(r-160,e.bin);return t}function Le(e){return function(){return e}}function W(e,r){return function(t){var i=e(t);return r(t,i)}}function Q(e,r){return function(t){return r(t,e)}}var ln=Ne.ExtBuffer,En=ft,pn=Ve.readUint8,dn=pt,dr=le;dr.install({addExtUnpacker:An,getExtUnpacker:vn,init:xt}),st.preset=xt.call(dr.preset);function xn(e){var r=dn.getReadToken(e);return t;function t(i){var n=pn(i),a=r[n];if(!a)throw new Error("Invalid type: "+(n&&"0x"+n.toString(16)));return a(i)}}function xt(){var e=this.options;return this.decode=xn(e),e&&e.preset&&En.setExtUnpackers(this),this}function An(e,r){var t=this.extUnpackers||(this.extUnpackers=[]);t[e]=dr.filter(r)}function vn(e){var r=this.extUnpackers||(this.extUnpackers=[]);return r[e]||t;function t(i){return new ln(i,e)}}lr.DecodeBuffer=me;var _n=st.preset,Bn=Ye.FlexDecoder;Bn.mixin(me.prototype);function me(e){if(!(this instanceof me))return new me(e);if(e&&(this.options=e,e.codec)){var r=this.codec=e.codec;r.bufferish&&(this.bufferish=r.bufferish)}}me.prototype.codec=_n,me.prototype.fetch=function(){return this.codec.decode(this)},hr.decode=Rn;var yn=lr.DecodeBuffer;function Rn(e,r){var t=new yn(r);return t.write(e),t.read()}var xr={exports:{}};/**
 * event-lite.js - Light-weight EventEmitter (less than 1KB when gzipped)
 *
 * @copyright Yusuke Kawasaki
 * @license MIT
 * @constructor
 * @see https://github.com/kawanet/event-lite
 * @see http://kawanet.github.io/event-lite/EventLite.html
 * @example
 * var EventLite = require("event-lite");
 *
 * function MyClass() {...}             // your class
 *
 * EventLite.mixin(MyClass.prototype);  // import event methods
 *
 * var obj = new MyClass();
 * obj.on("foo", function() {...});     // add event listener
 * obj.once("bar", function() {...});   // add one-time event listener
 * obj.emit("foo");                     // dispatch event
 * obj.emit("bar");                     // dispatch another event
 * obj.off("foo");                      // remove event listener
 */(function(e){function r(){if(!(this instanceof r))return new r}(function(t){e.exports=t;var i="listeners",n={on:s,once:E,off:R,emit:L};a(t.prototype),t.mixin=a;function a(l){for(var y in n)l[y]=n[y];return l}function s(l,y){return _(this,l).push(y),this}function E(l,y){var x=this;return d.originalListener=y,_(x,l).push(d),x;function d(){R.call(x,l,d),y.apply(this,arguments)}}function R(l,y){var x=this,d;if(!arguments.length)delete x[i];else if(y){if(d=_(x,l,!0),d){if(d=d.filter(D),!d.length)return R.call(x,l);x[i][l]=d}}else if(d=x[i],d&&(delete d[l],!Object.keys(d).length))return R.call(x);return x;function D(k){return k!==y&&k.originalListener!==y}}function L(l,y){var x=this,d=_(x,l,!0);if(!d)return!1;var D=arguments.length;if(D===1)d.forEach(I);else if(D===2)d.forEach(G);else{var k=Array.prototype.slice.call(arguments,1);d.forEach(X)}return!!d.length;function I(u){u.call(x)}function G(u){u.call(x,y)}function X(u){u.apply(x,k)}}function _(l,y,x){if(!(x&&!l[i])){var d=l[i]||(l[i]={});return d[y]||(d[y]=[])}}})(r)})(xr);var mn=xr.exports,At=tr.EncodeBuffer;function we(e){if(!(this instanceof we))return new we(e);At.call(this,e)}we.prototype=new At,mn.mixin(we.prototype),we.prototype.encode=function(e){this.write(e),this.emit("data",this.read())},we.prototype.end=function(e){arguments.length&&this.encode(e),this.flush(),this.emit("end")};var wn=xr.exports,vt=lr.DecodeBuffer;function pe(e){if(!(this instanceof pe))return new pe(e);vt.call(this,e)}pe.prototype=new vt,wn.mixin(pe.prototype),pe.prototype.decode=function(e){arguments.length&&this.write(e),this.flush()},pe.prototype.push=function(e){this.emit("data",e)},pe.prototype.end=function(e){this.decode(e),this.emit("end")},le.preset;var _t=rr.encode,Ar=hr.decode,bn=Date.now();class V extends Pt{constructor(r=!1){super(),this.socket=null,this.player=new Lt,this.players=[],this.gameObjects=[],this.alive=!1,this.hatsOwned={},this.accessoriesOwned={},this.projectiles=[];const t=this;if(r)Object.defineProperty(WebSocket.prototype,"hiddenSend",{value:WebSocket.prototype.send}),Object.defineProperty(WebSocket.prototype,"send",{value:function(i){t.socket==null&&(t.socket=this);const n=new Br(Ar(new Uint8Array(i)));if(t.emit("packetSend",n),n.isCanceled)return;n.type==J.SPAWN&&(t.alive=!0),this.hiddenSend(i)}});else{class i extends WebSocket{hiddenSend(a){super.send(a)}constructor(a){super(a),this.send=s=>{const E=new Br(Ar(new Uint8Array(s)));t.emit("packetSend",E),!E.isCanceled&&(E.type==J.SPAWN&&(t.alive=!0),this.hiddenSend(s))},t.socket=this,t.initSocket()}}Object.defineProperty(window,"WebSocket",{value:i})}Ut.forEach(i=>{i.price<=0&&!i.dontSell&&(this.hatsOwned[i.id]=!0)}),Mt.forEach(i=>{i.price<=0&&(this.accessoriesOwned[i.id]=!0)})}initSocket(){var r;(r=this.socket)==null||r.addEventListener("message",t=>{const i=new Rt(Ar(new Uint8Array(t.data)));this.emit("packetReceive",i);const n=i.payload;switch(i.type){case U.HEALTH:const R=n[0];this.emit("health",new mt(R,n[1])),this.players[R].health=n[1];break;case U.INIT:this.player.id=n[0];break;case U.SET_SID:this.players[n[0]]=this.player,this.player.sid=n[0];break;case U.UPDAE_PLAYERS:var s=[];const L=Date.now();for(const u of this.projectiles)u.range-=(L-bn)*u.speed,u.range<=0&&this.removeProjectile(u.sid);for(let u=0;u<n[0].length;u+=13){const p=n[0].slice(u,u+13),O={sid:p[0],x:p[1],y:p[2],dir:p[3],currentObject:p[4],wep:p[5],variant:p[6],tribe:p[7],isLeader:p[8],hat:p[9],acc:p[10],isSkull:p[11],zIndex:p[12]};this.players[O.sid]||(console.warn("Ran into unpredicted circumstance current player cannot be found, IPlayerDat, this.players, IPlayerDat.sid",O,this.players,O.sid),this.players[O.sid]=new Qe),this.emit("updatePlayer",O),this.players[O.sid].assign(O),s.push(O)}this.emit("serverTick",new Tt(s));break;case U.REMOVE_PLAYER:const _=this.getPlayerById(n[0]);_&&(this.emit("playerLeave",new yr(_)),delete this.players[_.sid]);break;case U.ADD_PLAYER:const l=n[0],y=l[1];var E=this.player;y!=this.player.sid&&(E=new Qe),E.sid=y,E.id=l[0],E.name=l[2],E.x=l[3],E.y=l[4],this.players[y]=E,this.emit("addPlayer",new yr(E));break;case U.ADD_OBJECT:for(let u=0;u<n[0].length;u+=8){const p=n[0].slice(u,u+8),O={id:p[0],x:p[1],y:p[2],dir:p[3],scale:p[4],type:p[5],buildType:p[6],ownerSid:p[7]};this.gameObjects[O.id]=O,this.emit("addObject",new wt(O))}break;case U.REMOVE_OBJECT:this.emit("removeObject",new mr(this.gameObjects[n[0]],Me.BUILDINGBREAK)),delete this.gameObjects[n[0]];break;case U.REMOVE_ALL_OBJECTS:for(let u=0;u<this.gameObjects.length;u++){const p=this.gameObjects[u];!p||p.ownerSid==n[0]&&(this.emit("removeObject",new mr(this.gameObjects[u],Me.PLAYERLEAVE)),this.gameObjects.slice(u,1))}break;case U.SET_ITEMS_BAR:n[0]&&(n[1]?this.player.weapons=n[0]:this.player.items=n[0]);break;case U.DEATH:this.player.weapons=[Ue.TOOL_HAMMER,void 0],this.player.items=[M.APPLE,M.WOOD_WALL,M.SPIKE,M.WINDMILL,void 0,void 0,void 0,void 0];break;case U.CHAT:const x=n[0],d=this.getPlayerBySid(x);if(d==null)return;const D=n[1];clearTimeout(d.messageTimeout),d.chatMessage=D,d.messageTimeout=setTimeout(()=>{d.chatMessage=null},3e3),this.emit("chat",new bt(x,D));break;case U.UPDATE_SHOP:if(n[0])break;const I=n[2],G=n[1];I?this.accessoriesOwned[G]=!0:this.hatsOwned[G]=!0;break;case U.ADD_PROJECTILE:const X=new Nt(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);this.emit("addProjectile",new gt(X)),this.projectiles.push(X);break;case U.REMOVE_PROJECTILE:this.removeProjectile(n[0]);break}})}getPlayerById(r){for(let t of this.players)if((t==null?void 0:t.id)==r)return t;return null}getPlayerBySid(r){for(let t of this.players)if((t==null?void 0:t.sid)==r)return t;return null}sendRaw(r){var t;(t=this.socket)==null||t.send(_t(r))}sendBasic(r,...t){this.sendRaw([r,t])}sendHidden(r,...t){var i=this.socket;i==null||i.hiddenSend(_t([r,t]))}spawn(r="moomooapi",t=er.RED,i=!0){this.sendBasic(J.SPAWN,{name:r,skin:t,moofoll:i})}setHand(r,t){this.sendBasic(J.SELECT_ITEM,r,t)}setItem(r){this.setHand(r,!1)}setWeapon(r){this.setHand(r,!0)}attack(r,t=null){this.sendBasic(J.ATTACK,r,t)}singleSwing(r=null){this.attack(!0,r),this.attack(!1)}placeItem(r,t=null){this.setItem(r),this.singleSwing(t),this.setWeapon(this.player.wep)}toggleAutoFire(){this.sendBasic(J.AUTO_ATTACK,1)}setGear(r,t,i){this.sendBasic(J.BUY_AND_EQUIP,r,t,i)}buyGear(r,t){this.setGear(!0,r,t)}buyHat(r){this.buyGear(r,!1)}equipGear(r,t){this.setGear(!1,r,t)}equipHat(r){this.equipGear(r,!1)}buyAccessory(r){this.buyGear(r,!0)}equipAccessory(r){this.equipGear(r,!0)}chat(r){this.sendBasic(J.CHAT,r)}removeProjectile(r){for(let t=0;t<this.projectiles.length;t++)this.projectiles[t].sid==r&&(this.emit("removeProjectile",new Ot(this.projectiles[t])),this.projectiles.splice(t,1))}}V.SkinColours=er,V.C2SPacketType=J,V.S2CPacketType=U,V.ObjectRemoveReason=Me,V.ItemIds=M,V.WeaponIds=Ue,V.Repeater=St,V.HatIds=br,V.AccessoryIds=Tr,Object.defineProperty(window,"MooMooAPI",{value:V}),de.MooMooAPI=V,Object.defineProperties(de,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
